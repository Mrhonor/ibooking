{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport layout from '@/components/layout-page.vue';\nimport { getStudyRoom, renewStudyRoom, addStudyRoom, deleteStudyRoom } from '@/api/request';\nexport default {\n  components: {\n    layout\n  },\n\n  data() {\n    return {\n      currentPage: 1,\n      pagesize: 10,\n      total: 10,\n      tableData: [],\n      Visible: false,\n      addVisible: false,\n      deleteVisible: false,\n      bookingVal: '',\n      bookingInfo: [],\n      form: {\n        index: '',\n        stuRoomNumber: '',\n        buildingNumber: '',\n        classRoomNumber: '',\n        openStatus: '',\n        time: '',\n        returnTime: []\n      },\n      open: true,\n      status: ''\n    };\n  },\n\n  methods: {\n    handleCurrentChange(page) {\n      this.currentPage = page;\n      this.query();\n    },\n\n    query() {\n      getStudyRoom().then(res => {\n        if (res) {\n          this.tableData = res;\n\n          for (let i in res) {\n            if (res[i].openStatus) this.tableData[i].openStatus = \"是\";else this.tableData[i].openStatus = \"否\"; // console.log(this.tableData[i].openStatus)\n          }\n\n          this.total = res.length;\n        }\n      });\n    },\n\n    renewRoom(val) {\n      // this.form.id = val.index\n      this.form.stuRoomNumber = val.stuRoomNumber;\n      this.form.buildingNumber = val.buildingNumber;\n      this.form.classRoomNumber = val.classRoomNumber; // console.log(val.openStatus)\n      // if (val.openStatus==\"是\") this.status = \"true\"\n      // else this.status = \"false\"\n      // console.log(this.status)\n\n      this.form.openStatus = val.openStatus; // console.log('更新', this.form.openStatus)\n\n      this.form.returnTime.push(val.startTime, val.endTime); // this.form.time.push(val.startTime, val.endTime)\n\n      this.Visible = true;\n    },\n\n    sure() {\n      if (this.form.openStatus == \"是\" && !this.form.time) {\n        this.$message.info('请选择自习室开放时间和结束时间！');\n        return;\n      }\n\n      if (!this.form.time) {\n        this.form.time = [null, null]; //灰色\n      }\n\n      if (this.form.openStatus == \"是\" || this.form.openStatus == \"true\") this.open = true;else this.open = false;\n      let data = {\n        // id: this.form.index,\n        stuRoomNumber: this.form.stuRoomNumber,\n        buildingNumber: this.form.buildingNumber,\n        classRoomNumber: this.form.classRoomNumber,\n        openStatus: this.open,\n        startTime: this.form.time[0],\n        endTime: this.form.time[1]\n      };\n      renewStudyRoom(data).then(res => {\n        this.Visible = false; // 刷新页面\n\n        this.form = {\n          index: '',\n          stuRoomNumber: '',\n          buildingNumber: '',\n          classRoomNumber: '',\n          openStatus: '',\n          time: '',\n          returnTime: []\n        };\n        this.$message.success('更新成功');\n        getStudyRoom().then(res => {\n          if (res) {\n            this.tableData = res;\n\n            for (let i in res) {\n              if (res[i].openStatus) this.tableData[i].openStatus = \"是\";else this.tableData[i].openStatus = \"否\";\n            }\n\n            this.total = res.length;\n          }\n        });\n      }).catch(err => {\n        console.log(err);\n        this.$message.success('更新失败');\n      });\n    },\n\n    add() {\n      this.addVisible = true;\n    },\n\n    addSure() {\n      if (this.form.openStatus == \"是\" && !this.form.time) {\n        this.$message.info('请选择自习室开放时间和结束时间！');\n        return;\n      }\n\n      if (!this.form.time) {\n        this.form.time = [null, null]; //灰色\n      } // console.log(this.form.openStatus)\n\n\n      if (this.form.openStatus == \"是\" || this.form.openStatus == \"true\") this.open = true;else this.open = false;\n      let data = {\n        // id: this.form.index,\n        stuRoomNumber: this.form.stuRoomNumber,\n        buildingNumber: this.form.buildingNumber,\n        classRoomNumber: this.form.classRoomNumber,\n        openStatus: this.open,\n        startTime: this.form.time[0],\n        endTime: this.form.time[1]\n      };\n      console.log(data);\n      addStudyRoom(data).then(res => {\n        this.addVisible = false; // 刷新页面\n\n        this.form = {\n          index: '',\n          stuRoomNumber: '',\n          buildingNumber: '',\n          classRoomNumber: '',\n          openStatus: '',\n          time: '',\n          returnTime: []\n        };\n        this.$message.success('更新成功');\n        getStudyRoom().then(res => {\n          if (res) {\n            this.tableData = res;\n\n            for (let i in res) {\n              if (res[i].openStatus) this.tableData[i].openStatus = \"是\";else this.tableData[i].openStatus = \"否\";\n            }\n\n            this.total = res.length;\n          }\n        });\n      }).catch(err => {\n        console.log(err);\n        this.$message.success('更新失败');\n      });\n    },\n\n    deleteRoom(val) {\n      this.form.stuRoomNumber = val.stuRoomNumber;\n      this.deleteVisible = true;\n    },\n\n    deleteSure(data) {\n      // console.log(data)\n      deleteStudyRoom(data).then(res => {\n        this.deleteVisible = false; // 刷新页面\n\n        this.form = {\n          index: '',\n          stuRoomNumber: '',\n          buildingNumber: '',\n          classRoomNumber: '',\n          openStatus: '',\n          time: '',\n          returnTime: []\n        };\n        this.$message.success('删除成功');\n        getStudyRoom().then(res => {\n          if (res) {\n            this.tableData = res;\n\n            for (let i in res) {\n              if (res[i].openStatus) this.tableData[i].openStatus = \"是\";else this.tableData[i].openStatus = \"否\";\n            }\n\n            this.total = res.length;\n          }\n        });\n      }).catch(err => {\n        console.log(err);\n        this.$message.success('删除失败');\n      });\n    }\n\n  },\n\n  mounted() {\n    this.query();\n  }\n\n};","map":null,"metadata":{},"sourceType":"module"}