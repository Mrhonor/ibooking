{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport layout from '@/components/layout-page.vue';\nimport { getSeatBook, booking } from '@/api/request';\nimport BookChooseRoom from './book-chooseRoom.vue';\nexport default {\n  components: {\n    layout\n  },\n\n  data() {\n    return {\n      currentPage: 1,\n      pagesize: 10,\n      total: 10,\n      tableData: [],\n      active: 2,\n      pickerOptions1: {\n        //   disabledDate(time) {\n        //     return time.getTime() < Date.now()-3600 * 1000 * 24;\n        //   },\n        shortcuts: [{\n          text: '今天',\n\n          onClick(picker) {\n            picker.$emit('pick', new Date());\n          }\n\n        }, {\n          text: '明天',\n\n          onClick(picker) {\n            const date = new Date();\n            date.setTime(date.getTime() + 3600 * 1000 * 24);\n            picker.$emit('pick', date);\n          }\n\n        }, {\n          text: '后天',\n\n          onClick(picker) {\n            const date = new Date();\n            date.setTime(date.getTime() + 3600 * 1000 * 24 * 2);\n            picker.$emit('pick', date);\n          }\n\n        }]\n      },\n      value2: '',\n      chooseDd: '',\n      seatNum: this.$route.query.seatnum,\n      roomNum: this.$route.query.roomnum,\n      start: this.$route.query.st,\n      end: this.$route.query.et,\n      startTime: '',\n      endTime: '',\n      timeLimite: '',\n      form: {\n        index: '',\n        stuRoomNumber: '',\n        buildingNumber: '',\n        classRoomNumber: '',\n        openStatus: '',\n        time: '',\n        returnTime: []\n      },\n      open: true\n    };\n  },\n\n  methods: {\n    handleCurrentChange(page) {\n      this.currentPage = page;\n      this.query();\n    },\n\n    Limite(startTime) {\n      let min = parseInt(startTime.split(\":\")[1]) + 1;\n      this.timeLimite = (parseInt(startTime) + 4).toString().padStart(2, '0') + \":\" + min.toString().padStart(2, '0');\n    },\n\n    next() {\n      if (this.active++ > 3) this.active = 0;\n    },\n\n    query() {\n      getSeatBook(this.seatNum).then(res => {\n        if (res) {\n          // console.log(typeof this.value2)\n          this.tableData = [];\n\n          for (let i in res) {\n            let d = new Date(res[i].startTime);\n            let day = d.getDate();\n            let year = d.getFullYear();\n            let mon = d.getMonth() + 1;\n            let dd = year + \"-\" + mon + \"-\" + day;\n            d = new Date(this.value2);\n            console.log(d);\n            day = d.getDate();\n            year = this.value2.getFullYear();\n            mon = this.value2.getMonth() + 1;\n            this.chooseDd = year + \"-\" + mon + \"-\" + day;\n\n            if (dd == this.chooseDd) {\n              this.tableData.push(res[i]);\n            }\n          }\n\n          this.total = res.length;\n        }\n      });\n    },\n\n    sure() {\n      if (!this.startTime || !this.endTime) {\n        this.$message.info('请选择预约开始时间和结束时间！');\n        return;\n      }\n\n      let start = this.chooseDd + ' ' + this.startTime + ':00';\n      let end = this.chooseDd + ' ' + this.endTime + ':00';\n      console.log(typeof start, start);\n      let data = {\n        // id: this.form.index,\n        seatNum: this.seatNum,\n        startTime: start,\n        endTime: end,\n        SignIn: false,\n        isEnd: false,\n        isTimeout: false\n      };\n      booking(data).then(res => {\n        console.log(res);\n        this.$message.success('预约成功');\n        next();\n      }).catch(err => {\n        console.log(err);\n        this.$message.success('预约失败');\n      });\n    },\n\n    renew() {\n      this.valu2 = '';\n      this.startTime = '';\n      this.endTime = '';\n      this.timeLimite = '';\n      this.chooseDd = '';\n    }\n\n  },\n\n  mounted() {\n    this.query();\n  }\n\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgEA;AACA;AACA;AAEA;EACAA;IACAC;EADA,CADA;;EAIAC;IACA;MACAC,cADA;MAEAC,YAFA;MAGAC,SAHA;MAIAC,aAJA;MAKAC,SALA;MAMAC;QACA;QACA;QACA;QACAC;UACAC,UADA;;UAEAC;YACAC;UACA;;QAJA,GAKA;UACAF,UADA;;UAEAC;YACA;YACAE;YACAD;UACA;;QANA,CALA,EAYA;UACAF,UADA;;UAEAC;YACA;YACAE;YACAD;UACA;;QANA,CAZA;MAJA,CANA;MAgCAE,UAhCA;MAiCAC,YAjCA;MAkCAC,kCAlCA;MAmCAC,kCAnCA;MAoCAC,2BApCA;MAqCAC,yBArCA;MAsCAC,aAtCA;MAuCAC,WAvCA;MAwCAC,cAxCA;MA0CAC;QACAC,SADA;QAEAC,iBAFA;QAGAC,kBAHA;QAIAC,mBAJA;QAKAC,cALA;QAMAC,QANA;QAOAC;MAPA,CA1CA;MAmDAC;IAnDA;EAsDA,CA3DA;;EA4DAC;IACAC;MACA;MACA;IACA,CAJA;;IAKAC;MACA;MACA;IACA,CARA;;IASAC;MACA;IACA,CAXA;;IAYAC;MACAC;QACA;UACA;UACA;;UACA;YACA;YACA;YACA;YACA;YACA;YAEAC;YACAC;YACAC;YACAC;YACAC;YACA;;YACA;cACA;YACA;UACA;;UACA;QACA;MACA,CAvBA;IAwBA,CArCA;;IAsCAC;MACA;QACA;QACA;MACA;;MACA;MACA;MACAJ;MACA;QACA;QACAvB,qBAFA;QAGAI,gBAHA;QAIAC,YAJA;QAKAuB,aALA;QAMAC,YANA;QAOAC;MAPA;MASAC;QACAR;QACA;QACAJ;MACA,CAJA,EAIAa,KAJA,CAIAC;QACAV;QACA;MACA,CAPA;IAQA,CA/DA;;IAgEAW;MACA;MACA;MACA;MACA;MACA;IACA;;EAtEA,CA5DA;;EAoIAC;IACA;EACA;;AAtIA","names":["components","layout","data","currentPage","pagesize","total","tableData","active","pickerOptions1","shortcuts","text","onClick","picker","date","value2","chooseDd","seatNum","roomNum","start","end","startTime","endTime","timeLimite","form","index","stuRoomNumber","buildingNumber","classRoomNumber","openStatus","time","returnTime","open","methods","handleCurrentChange","Limite","next","query","getSeatBook","d","console","day","year","mon","sure","SignIn","isEnd","isTimeout","booking","catch","err","renew","mounted"],"sourceRoot":"src/views","sources":["book-chooseTime.vue"],"sourcesContent":["<template>\r\n    <layout>\r\n        <div>\r\n            <el-steps :active=\"active\" finish-status=\"success\">\r\n                <el-step title=\"选择自习室\"></el-step>\r\n                <el-step title=\"选择座位\"></el-step>\r\n                <el-step title=\"选择时间\"></el-step>\r\n                <el-step title=\"预约\"></el-step>\r\n            </el-steps>\r\n            <div class=\"block\">\r\n                <span class=\"demonstration\">选择日期</span>\r\n                <el-date-picker\r\n                    v-model=\"value2\"\r\n                    align=\"right\"\r\n                    type=\"date\"\r\n                    placeholder=\"选择日期\"\r\n                    :picker-options=\"pickerOptions1\"\r\n                    @change=\"query\">\r\n                </el-date-picker>\r\n            </div>\r\n            <el-table :data=\"tableData\" border style=\"width: 100%\">\r\n                <el-table-column type=\"index\" label=\"序号\" align=\"center\" width=\"55px\" />\r\n                <el-table-column prop=\"startTime\" type=\"datatime\" label=\"预约时间\" align=\"center\"/>\r\n                <el-table-column prop=\"endTime\" type=\"datatime\" label=\"结束时间\" align=\"center\"/>\r\n            </el-table>\r\n            <el-pagination\r\n                @current-change=\"handleCurrentChange\"\r\n                :current-page=\"currentPage\"\r\n                :page-size=\"10\"\r\n                layout=\"total, prev, pager, next, jumper\"\r\n                :total=\"total\">\r\n            </el-pagination>\r\n            <div class=\"block\">\r\n                <span class=\"demonstration\">选择时间</span>\r\n                <el-time-select\r\n                    placeholder=\"起始时间\"\r\n                    v-model=\"startTime\"\r\n                    :picker-options=\"{\r\n                        start: this.start,\r\n                        step: '00:15',\r\n                        end: this.end,\r\n                    }\"\r\n                    @change=\"Limite(startTime)\">\r\n                </el-time-select>\r\n                <el-time-select\r\n                    placeholder=\"结束时间\"\r\n                    v-model=\"endTime\"\r\n                    :picker-options=\"{\r\n                        start: this.start,\r\n                        step: '00:15',\r\n                        end: this.end,\r\n                        minTime: this.startTime,\r\n                        maxTime: this.timeLimite\r\n                    }\">\r\n                </el-time-select>\r\n            </div>\r\n            <el-footer>\r\n                <el-button type=\"primary\" @click=\"sure\">确 定</el-button>\r\n                <el-button @click=\"renew\">重 置</el-button>\r\n            </el-footer>\r\n        </div>\r\n    </layout>\r\n</template>\r\n<script>\r\nimport layout from '@/components/layout-page.vue'\r\nimport { getSeatBook, booking } from '@/api/request'\r\nimport BookChooseRoom from './book-chooseRoom.vue';\r\n\r\nexport default ({\r\n    components: {\r\n        layout,\r\n    },\r\n    data() {\r\n      return {\r\n        currentPage: 1,\r\n        pagesize: 10,\r\n        total: 10,\r\n        tableData: [],\r\n        active: 2,\r\n        pickerOptions1: {\r\n        //   disabledDate(time) {\r\n        //     return time.getTime() < Date.now()-3600 * 1000 * 24;\r\n        //   },\r\n          shortcuts: [{\r\n            text: '今天',\r\n            onClick(picker) {\r\n              picker.$emit('pick', new Date());\r\n            }\r\n          }, {\r\n            text: '明天',\r\n            onClick(picker) {\r\n              const date = new Date();\r\n              date.setTime(date.getTime() + 3600 * 1000 * 24);\r\n              picker.$emit('pick', date);\r\n            }\r\n          }, {\r\n            text: '后天',\r\n            onClick(picker) {\r\n              const date = new Date();\r\n              date.setTime(date.getTime() + 3600 * 1000 * 24 * 2);\r\n              picker.$emit('pick', date);\r\n            }\r\n          }\r\n        ],\r\n        },\r\n        value2:'',\r\n        chooseDd:'',\r\n        seatNum:this.$route.query.seatnum,\r\n        roomNum:this.$route.query.roomnum,\r\n        start: this.$route.query.st,\r\n        end: this.$route.query.et,\r\n        startTime:'',\r\n        endTime:'',\r\n        timeLimite:'',\r\n        \r\n        form: {\r\n            index: '',\r\n            stuRoomNumber: '',\r\n            buildingNumber: '',\r\n            classRoomNumber: '',\r\n            openStatus: '',\r\n            time: '',\r\n            returnTime:[],\r\n        },\r\n        open: true,\r\n\r\n      }\r\n    },\r\n    methods: {\r\n        handleCurrentChange(page) {\r\n            this.currentPage = page\r\n            this.query()\r\n        },\r\n        Limite(startTime){\r\n            let min = parseInt(startTime.split(\":\")[1]) + 1\r\n            this.timeLimite = (parseInt(startTime)+4).toString().padStart(2,'0')+\":\"+min.toString().padStart(2,'0')\r\n        },\r\n        next() {\r\n            if (this.active++ > 3) this.active = 0;\r\n        },\r\n        query() {\r\n            getSeatBook(this.seatNum).then((res) => {\r\n                if(res) {\r\n                    // console.log(typeof this.value2)\r\n                    this.tableData = []\r\n                    for (let i in res) {\r\n                        let d = new Date(res[i].startTime)\r\n                        let day = d.getDate()\r\n                        let year = d.getFullYear()\r\n                        let mon = d.getMonth() + 1\r\n                        let dd = year+\"-\"+mon+\"-\"+day\r\n                        \r\n                        d = new Date(this.value2)\r\n                        console.log(d)\r\n                        day = d.getDate()\r\n                        year = this.value2.getFullYear()\r\n                        mon = this.value2.getMonth() + 1\r\n                        this.chooseDd = year+\"-\"+mon+\"-\"+day\r\n                        if (dd==this.chooseDd){\r\n                            this.tableData.push(res[i])\r\n                        }\r\n                    }\r\n                    this.total = res.length\r\n                } \r\n            })\r\n        },\r\n        sure(){\r\n            if( !this.startTime || !this.endTime) {\r\n                this.$message.info('请选择预约开始时间和结束时间！')\r\n                return\r\n            }\r\n            let start = this.chooseDd + ' ' + this.startTime + ':00'\r\n            let end = this.chooseDd+ ' ' + this.endTime + ':00'\r\n            console.log(typeof start, start)\r\n            let data = {\r\n                // id: this.form.index,\r\n                seatNum: this.seatNum,\r\n                startTime: start,\r\n                endTime: end,\r\n                SignIn: false,\r\n                isEnd: false,\r\n                isTimeout: false,\r\n            }\r\n            booking(data).then((res) => {\r\n                console.log(res)\r\n                this.$message.success('预约成功')\r\n                next()\r\n            }).catch(err=>{\r\n                console.log(err)\r\n                this.$message.success('预约失败')\r\n            })\r\n        },\r\n        renew(){\r\n            this.valu2=''\r\n            this.startTime=''\r\n            this.endTime=''\r\n            this.timeLimite=''\r\n            this.chooseDd=''\r\n        }\r\n    },\r\n    mounted() {\r\n        this.query()\r\n    },\r\n})\r\n</script>\r\n<style scoped>\r\n.el-table {\r\n    margin-top: 15px;\r\n}\r\n.el-pagination {\r\n    margin-top: 15px;\r\n    float: right;\r\n}\r\n.item {\r\n  width: 32px;\r\n  height: 32px;\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}