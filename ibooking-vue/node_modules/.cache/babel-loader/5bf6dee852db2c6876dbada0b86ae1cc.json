{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport layout from '@/components/layout-page.vue';\nimport { getSeatBook } from '@/api/request';\nexport default {\n  components: {\n    layout\n  },\n\n  data() {\n    return {\n      currentPage: 1,\n      pagesize: 10,\n      total: 10,\n      tableData: [],\n      active: 0,\n      Visible: false,\n      pickerOptions1: {\n        //   disabledDate(time) {\n        //     return time.getTime() < Date.now()-3600 * 1000 * 24;\n        //   },\n        shortcuts: [{\n          text: '今天',\n\n          onClick(picker) {\n            picker.$emit('pick', new Date());\n          }\n\n        }, {\n          text: '明天',\n\n          onClick(picker) {\n            const date = new Date();\n            date.setTime(date.getTime() + 3600 * 1000 * 24);\n            picker.$emit('pick', date);\n          }\n\n        }, {\n          text: '后天',\n\n          onClick(picker) {\n            const date = new Date();\n            date.setTime(date.getTime() + 3600 * 1000 * 24 * 2);\n            picker.$emit('pick', date);\n          }\n\n        }]\n      },\n      value2: '',\n      seatNum: this.$route.query.seatnum,\n      roomNum: this.$route.query.roomnum,\n      start: this.$route.query.st,\n      end: this.$route.query.et,\n      startTime: '',\n      endTime: '',\n      time: this.startTime,\n      timeLimite: '',\n      form: {\n        index: '',\n        stuRoomNumber: '',\n        buildingNumber: '',\n        classRoomNumber: '',\n        openStatus: '',\n        time: '',\n        returnTime: []\n      },\n      open: true\n    };\n  },\n\n  methods: {\n    handleCurrentChange(page) {\n      this.currentPage = page;\n      this.query();\n    },\n\n    Limite(startTime) {\n      let min = parseInt(startTime.split(\":\")[1]) + 1;\n      this.timeLimite = (parseInt(startTime) + 4).toString().padStart(2, '0') + \":\" + min.toString().padStart(2, '0');\n    },\n\n    next() {\n      if (this.active++ > 2) this.active = 0;\n    },\n\n    getDay(d) {\n      let day = d.getDate();\n      let year = d.getFullYear();\n      let mon = d.getMonth() + 1;\n      let dd = year + \"-\" + mon + \"-\" + day;\n      return dd;\n    },\n\n    query() {\n      getSeatBook(this.seatNum).then(res => {\n        if (res) {\n          // this.tableData = res\n          for (let i in res) {\n            let d = new Date(res[i].startTime);\n            let dd = getDay(d);\n            let chooseDd = getDay(this.value2);\n            console.log(dd, chooseDd);\n\n            if (dd == this.value2) {\n              this.tableData.push(res[i]);\n            } // console.log(this.tableData)\n\n          }\n\n          this.total = res.length;\n        }\n      });\n    },\n\n    chooseSeat(val) {\n      let roomNum = this.$route.query.roomnum;\n      this.start = this.$route.query.st;\n      this.end = this.$route.query.et;\n      $router.replace('/book/seat/time?roomnum=' + roomNum + '&seatnum=' + val.seatNum);\n    }\n\n  },\n\n  mounted() {\n    this.query();\n  }\n\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoDA;AACA;AAEA;EACAA;IACAC;EADA,CADA;;EAIAC;IACA;MACAC,cADA;MAEAC,YAFA;MAGAC,SAHA;MAIAC,aAJA;MAKAC,SALA;MAMAC,cANA;MAOAC;QACA;QACA;QACA;QACAC;UACAC,UADA;;UAEAC;YACAC;UACA;;QAJA,GAKA;UACAF,UADA;;UAEAC;YACA;YACAE;YACAD;UACA;;QANA,CALA,EAYA;UACAF,UADA;;UAEAC;YACA;YACAE;YACAD;UACA;;QANA,CAZA;MAJA,CAPA;MAiCAE,UAjCA;MAkCAC,kCAlCA;MAmCAC,kCAnCA;MAoCAC,2BApCA;MAqCAC,yBArCA;MAsCAC,aAtCA;MAuCAC,WAvCA;MAwCAC,oBAxCA;MAyCAC,cAzCA;MA2CAC;QACAC,SADA;QAEAC,iBAFA;QAGAC,kBAHA;QAIAC,mBAJA;QAKAC,cALA;QAMAP,QANA;QAOAQ;MAPA,CA3CA;MAoDAC;IApDA;EAuDA,CA5DA;;EA6DAC;IACAC;MACA;MACA;IACA,CAJA;;IAKAC;MACA;MACA;IACA,CARA;;IASAC;MACA;IACA,CAXA;;IAYAC;MACA;MACA;MACA;MACA;MACA;IACA,CAlBA;;IAmBAC;MACAC;QACA;UACA;UACA;YACA;YACA;YACA;YACAC;;YACA;cACA;YACA,CAPA,CAQA;;UACA;;UACA;QAEA;MACA,CAhBA;IAiBA,CArCA;;IAsCAC;MACA;MACA;MACA;MACAC;IACA;;EA3CA,CA7DA;;EA0GAC;IACA;EACA;;AA5GA","names":["components","layout","data","currentPage","pagesize","total","tableData","active","Visible","pickerOptions1","shortcuts","text","onClick","picker","date","value2","seatNum","roomNum","start","end","startTime","endTime","time","timeLimite","form","index","stuRoomNumber","buildingNumber","classRoomNumber","openStatus","returnTime","open","methods","handleCurrentChange","Limite","next","getDay","query","getSeatBook","console","chooseSeat","$router","mounted"],"sourceRoot":"src/views","sources":["book-chooseTime.vue"],"sourcesContent":["<template>\r\n    <layout>\r\n        <div>\r\n            <el-steps :active=\"active\" finish-status=\"success\">\r\n                <el-step title=\"选择自习室\"></el-step>\r\n                <el-step title=\"选择座位\"></el-step>\r\n                <el-step title=\"预约\"></el-step>\r\n            </el-steps>\r\n            <div class=\"block\">\r\n                <span class=\"demonstration\">选择日期</span>\r\n                <el-date-picker\r\n                    v-model=\"value2\"\r\n                    align=\"right\"\r\n                    type=\"date\"\r\n                    placeholder=\"选择日期\"\r\n                    :picker-options=\"pickerOptions1\"\r\n                    @change=\"query\">\r\n                </el-date-picker>\r\n            </div>\r\n            <el-table :data=\"tableData\" border style=\"width: 100%\">\r\n                <el-table-column type=\"index\" label=\"序号\" align=\"center\" width=\"55px\" />\r\n                <el-table-column prop=\"startTime\" type=\"datatime\" label=\"预约时间\" align=\"center\"/>\r\n                <el-table-column prop=\"endTime\" type=\"datatime\" label=\"结束时间\" align=\"center\"/>\r\n            </el-table>\r\n            <div class=\"block\">\r\n                <span class=\"demonstration\">选择时间</span>\r\n                <el-time-select\r\n                    placeholder=\"起始时间\"\r\n                    v-model=\"startTime\"\r\n                    :picker-options=\"{\r\n                        start: this.start,\r\n                        step: '00:15',\r\n                        end: this.end,\r\n                    }\"\r\n                    @change=\"Limite(startTime)\">\r\n                </el-time-select>\r\n                <el-time-select\r\n                    placeholder=\"结束时间\"\r\n                    v-model=\"endTime\"\r\n                    :picker-options=\"{\r\n                        start: this.start,\r\n                        step: '00:15',\r\n                        end: this.end,\r\n                        minTime: this.startTime,\r\n                        maxTime: this.timeLimite\r\n                    }\">\r\n                </el-time-select>\r\n            </div>\r\n        </div>\r\n    </layout>\r\n</template>\r\n<script>\r\nimport layout from '@/components/layout-page.vue'\r\nimport { getSeatBook } from '@/api/request'\r\n\r\nexport default ({\r\n    components: {\r\n        layout,\r\n    },\r\n    data() {\r\n      return {\r\n        currentPage: 1,\r\n        pagesize: 10,\r\n        total: 10,\r\n        tableData: [],\r\n        active: 0,\r\n        Visible: false,\r\n        pickerOptions1: {\r\n        //   disabledDate(time) {\r\n        //     return time.getTime() < Date.now()-3600 * 1000 * 24;\r\n        //   },\r\n          shortcuts: [{\r\n            text: '今天',\r\n            onClick(picker) {\r\n              picker.$emit('pick', new Date());\r\n            }\r\n          }, {\r\n            text: '明天',\r\n            onClick(picker) {\r\n              const date = new Date();\r\n              date.setTime(date.getTime() + 3600 * 1000 * 24);\r\n              picker.$emit('pick', date);\r\n            }\r\n          }, {\r\n            text: '后天',\r\n            onClick(picker) {\r\n              const date = new Date();\r\n              date.setTime(date.getTime() + 3600 * 1000 * 24 * 2);\r\n              picker.$emit('pick', date);\r\n            }\r\n          }\r\n        ],\r\n        },\r\n        value2:'',\r\n        seatNum:this.$route.query.seatnum,\r\n        roomNum:this.$route.query.roomnum,\r\n        start: this.$route.query.st,\r\n        end: this.$route.query.et,\r\n        startTime:'',\r\n        endTime:'',\r\n        time: this.startTime,\r\n        timeLimite:'',\r\n        \r\n        form: {\r\n            index: '',\r\n            stuRoomNumber: '',\r\n            buildingNumber: '',\r\n            classRoomNumber: '',\r\n            openStatus: '',\r\n            time: '',\r\n            returnTime:[],\r\n        },\r\n        open: true,\r\n\r\n      }\r\n    },\r\n    methods: {\r\n        handleCurrentChange(page) {\r\n            this.currentPage = page\r\n            this.query()\r\n        },\r\n        Limite(startTime){\r\n            let min = parseInt(startTime.split(\":\")[1]) + 1\r\n            this.timeLimite = (parseInt(startTime)+4).toString().padStart(2,'0')+\":\"+min.toString().padStart(2,'0')\r\n        },\r\n        next() {\r\n            if (this.active++ > 2) this.active = 0;\r\n        },\r\n        getDay(d){\r\n            let day = d.getDate()\r\n            let year = d.getFullYear()\r\n            let mon = d.getMonth() + 1\r\n            let dd = year+\"-\"+mon+\"-\"+day\r\n            return dd\r\n        },\r\n        query() {\r\n            getSeatBook(this.seatNum).then((res) => {\r\n                if(res) {\r\n                    // this.tableData = res\r\n                    for (let i in res) {\r\n                        let d = new Date(res[i].startTime)\r\n                        let dd = getDay(d)\r\n                        let chooseDd = getDay(this.value2)\r\n                        console.log(dd, chooseDd)\r\n                        if (dd==this.value2){\r\n                            this.tableData.push(res[i])\r\n                        }\r\n                        // console.log(this.tableData)\r\n                    }\r\n                    this.total = res.length\r\n\r\n                } \r\n            })\r\n        },\r\n        chooseSeat(val){\r\n            let roomNum = this.$route.query.roomnum\r\n            this.start = this.$route.query.st\r\n            this.end = this.$route.query.et\r\n            $router.replace('/book/seat/time?roomnum='+roomNum+'&seatnum='+val.seatNum)\r\n        },\r\n    },\r\n    mounted() {\r\n        this.query()\r\n    },\r\n})\r\n</script>\r\n<style scoped>\r\n.el-table {\r\n    margin-top: 15px;\r\n}\r\n.el-pagination {\r\n    margin-top: 15px;\r\n    float: right;\r\n}\r\n.item {\r\n  width: 32px;\r\n  height: 32px;\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}