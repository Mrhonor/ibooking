{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport layout from '@/components/layout-page.vue';\nimport { getStuBook, bookingDel } from '@/api/request';\nexport default {\n  components: {\n    layout\n  },\n\n  data() {\n    return {\n      currentPage: 1,\n      pagesize: 10,\n      total: 10,\n      tableData: [],\n      testdata: [{\n        \"id\": 1,\n        \"seatId\": 1,\n        \"startTime\": \"2023-05-29 10:00\",\n        \"endTime\": \"2023-05-29 12:00\",\n        \"isEnd\": false,\n        \"isTimeout\": false,\n        \"stuNum\": \"20230001\",\n        \"name\": \"John Doe\",\n        \"buildingNum\": \"Building1\",\n        \"classRoomNum\": \"Class1\"\n      }]\n    };\n  },\n\n  methods: {\n    handleCurrentChange(page) {\n      this.currentPage = page;\n      this.query();\n    },\n\n    query() {\n      const stuNum = 1; // getStuBook(stuNum).then((res) => {\n      //     if(res) {\n\n      let res = this.testdata; // console.log(res)\n\n      if (!res.length) {\n        this.tableData = [res];\n      } else {\n        this.tableData = res;\n      }\n\n      for (let i in res) {\n        let st = new Date(this.tableData[i].startTime);\n        let d = st.getDate();\n        let y = st.getFullYear();\n        let mon = st.getMonth() + 1;\n        let h = st.getHours();\n        let m = new Date(st).getMinutes();\n        let s = new Date(st).getSeconds();\n        let start = h + ':' + m + ':' + s; // console.log(y+'-'+ mon +'-'+d)\n\n        this.tableData[i].day = y + '-' + mon + '-' + d;\n        this.tableData[i].start = start;\n        let et = new Date(this.tableData[i].endTime);\n        let eh = et.getHours();\n        let em = et.getMinutes();\n        let es = et.getSeconds();\n        let end = eh + ':' + em + ':' + es;\n        this.tableData[i].end = end;\n      } // console.log('最后的',this.tableData)\n      // this.total = res.length\n      //     } \n      // })\n\n    },\n\n    timeToBook(val) {\n      let now = new Date();\n      if (val.startTime > now + 60 * 15 * 1000 || val.startTime + 60 * 5 * 1000 < now) return true;else return false;\n    },\n\n    bookStu(val) {\n      bookingCheck(val.stuNum).then(res => {\n        if (res) {\n          this.$message.success('签到成功');\n        } else {\n          this.$message.success('已超过签退时间，签到失败！');\n        }\n      });\n    },\n\n    unbookStu(val) {\n      this.$confirm('确定要退预约吗?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        bookingDel(val.id).then(res => {\n          if (res) {\n            this.query();\n            this.$message.success('退预约成功');\n          } else {\n            this.$message.success('退预约失败');\n          }\n        });\n      }).catch(() => {\n        this.$message.info('已取消');\n      });\n    }\n\n  },\n\n  mounted() {\n    this.query();\n  }\n\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkCA;AACA;AAEA;EACAA;IACAC;EADA,CADA;;EAIAC;IACA;MACAC,cADA;MAEAC,YAFA;MAGAC,SAHA;MAIAC,aAJA;MAKAC,WACA;QACA,OADA;QAEA,WAFA;QAGA,+BAHA;QAIA,6BAJA;QAKA,cALA;QAMA,kBANA;QAOA,oBAPA;QAQA,kBARA;QASA,0BATA;QAUA;MAVA,CADA;IALA;EAoBA,CAzBA;;EA0BAC;IACAC;MACA;MACA;IACA,CAJA;;IAKAC;MACA,iBADA,CAEA;MACA;;MACA,wBAJA,CAKA;;MACA;QACA;MACA,CAFA,MAEA;QACA;MACA;;MACA;QACA;QAEA;QACA;QACA;QACA;QACA;QACA;QACA,kCATA,CAUA;;QACA;QACA;QAEA;QACA;QACA;QACA;QACA;QACA;MACA,CA/BA,CAgCA;MACA;MACA;MACA;;IACA,CAzCA;;IA0CAC;MACA;MACA,iFACA,YADA,KAEA;IACA,CA/CA;;IAgDAC;MACAC;QACA;UACA;QACA,CAFA,MAGA;UACA;QACA;MACA,CAPA;IAQA,CAzDA;;IA0DAC;MACA;QACAC,uBADA;QAEAC,sBAFA;QAGAC;MAHA,GAIAC,IAJA,CAIA;QACAC;UACA;YACA;YACA;UACA,CAHA,MAGA;YACA;UACA;QACA,CAPA;MAQA,CAbA,EAaAC,KAbA,CAaA;QACA;MACA,CAfA;IAgBA;;EA3EA,CA1BA;;EAuGAC;IACA;EACA;;AAzGA","names":["components","layout","data","currentPage","pagesize","total","tableData","testdata","methods","handleCurrentChange","query","timeToBook","bookStu","bookingCheck","unbookStu","confirmButtonText","cancelButtonText","type","then","bookingDel","catch","mounted"],"sourceRoot":"src/views","sources":["account-management.vue"],"sourcesContent":["<template>\r\n    <layout>\r\n        <div>\r\n            <el-button type=\"primary\" @click=\"query\">查询</el-button>\r\n            <el-table :data=\"tableData\" border style=\"width: 100%\">\r\n                <el-table-column type=\"index\" label=\"序号\" align=\"center\" width=\"55px\"/>\r\n                <el-table-column prop=\"id\" label=\"学号\" align=\"center\" />\r\n                <el-table-column prop=\"buildingNum\" label=\"楼栋与教室\" align=\"center\"/>\r\n                <el-table-column prop=\"stuNum\" label=\"学生学号\" align=\"center\"/>\r\n                <el-table-column prop=\"day\" type=\"date\" label=\"预约日期\" align=\"center\"/>\r\n                <el-table-column prop=\"start\" type=\"datatime\" label=\"预约开始时间\" align=\"center\"/>\r\n                <el-table-column prop=\"end\" type=\"datatime\" label=\"预约结束时间\" align=\"center\"/>\r\n                <el-table-column\r\n                    fixed=\"right\"\r\n                    label=\"操作\"\r\n                    align=\"center\"\r\n                    width=\"100\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-button @click=\"bookStu(scope.row)\" type=\"text\" size=\"small\" :disabled=\"timeToBook(scope.row)? true:false\">签到</el-button>\r\n                        <el-button @click=\"unbookStu(scope.row)\" type=\"text\" size=\"small\" >退预约</el-button>\r\n                    </template>\r\n                </el-table-column>\r\n            </el-table>\r\n            <el-pagination\r\n                @current-change=\"handleCurrentChange\"\r\n                :current-page=\"currentPage\"\r\n                :page-size=\"10\"\r\n                layout=\"total, prev, pager, next, jumper\"\r\n                :total=\"total\">\r\n            </el-pagination>\r\n        </div>\r\n    </layout>\r\n</template>\r\n<script>\r\nimport layout from '@/components/layout-page.vue'\r\nimport { getStuBook,bookingDel } from '@/api/request'\r\n\r\nexport default ({\r\n    components: {\r\n        layout\r\n    },\r\n    data() {\r\n      return {\r\n        currentPage: 1,\r\n        pagesize: 10,\r\n        total: 10,\r\n        tableData: [],\r\n        testdata:[\r\n            {\r\n            \"id\": 1,\r\n            \"seatId\": 1,\r\n            \"startTime\": \"2023-05-29 10:00\",\r\n            \"endTime\": \"2023-05-29 12:00\",\r\n            \"isEnd\": false,\r\n            \"isTimeout\": false,\r\n            \"stuNum\": \"20230001\",\r\n            \"name\": \"John Doe\",\r\n            \"buildingNum\": \"Building1\",\r\n            \"classRoomNum\": \"Class1\"\r\n            },\r\n        ]\r\n      }\r\n    },\r\n    methods: {\r\n        handleCurrentChange(page) {\r\n            this.currentPage = page\r\n            this.query()\r\n        },\r\n        query() {\r\n            const stuNum = 1\r\n            // getStuBook(stuNum).then((res) => {\r\n            //     if(res) {\r\n            let res = this.testdata\r\n            // console.log(res)\r\n            if(!res.length){\r\n                this.tableData = [res]\r\n            }else{\r\n                this.tableData = res\r\n            }\r\n            for (let i in res){\r\n                let st = new Date(this.tableData[i].startTime)\r\n                \r\n                let d = st.getDate()\r\n                let y = st.getFullYear()\r\n                let mon = st.getMonth()+1\r\n                let h =  st.getHours()\r\n                let m = new Date(st).getMinutes()\r\n                let s = new Date(st).getSeconds()\r\n                let start = h+':'+m+':'+s\r\n                // console.log(y+'-'+ mon +'-'+d)\r\n                this.tableData[i].day = y+'-'+ mon +'-'+d\r\n                this.tableData[i].start = start\r\n                \r\n                let et = new Date(this.tableData[i].endTime)\r\n                let eh =  et.getHours()\r\n                let em = et.getMinutes()\r\n                let es = et.getSeconds()\r\n                let end = eh+':'+em+':'+es\r\n                this.tableData[i].end = end\r\n            }\r\n            // console.log('最后的',this.tableData)\r\n            // this.total = res.length\r\n            //     } \r\n            // })\r\n        },\r\n        timeToBook(val){\r\n            let now = new Date()\r\n            if ((val.startTime > now + 60 * 15 * 1000) || (val.startTime +60*5*1000 < now))\r\n            return true\r\n            else return false\r\n        },\r\n        bookStu(val){\r\n            bookingCheck(val.stuNum).then((res)=>{\r\n                if(res){\r\n                    this.$message.success('签到成功')\r\n                }\r\n                else{\r\n                    this.$message.success('已超过签退时间，签到失败！')\r\n                }\r\n            })\r\n        },\r\n        unbookStu(val){\r\n            this.$confirm('确定要退预约吗?', '提示', {\r\n                confirmButtonText: '确定',\r\n                cancelButtonText: '取消',\r\n                type: 'warning'\r\n            }).then(() => {\r\n                bookingDel(val.id).then((res) => {\r\n                    if(res) {\r\n                        this.query()\r\n                        this.$message.success('退预约成功')\r\n                    } else {\r\n                        this.$message.success('退预约失败')\r\n                    }\r\n                })\r\n            }).catch(() => {\r\n                this.$message.info('已取消')\r\n            })\r\n        }\r\n    },\r\n    mounted() {\r\n        this.query()\r\n    },\r\n})\r\n</script>\r\n<style scoped>\r\n.el-table {\r\n    margin-top: 15px;\r\n}\r\n.upload-demo {\r\n    display: inline-block;\r\n    margin-top: 15px;\r\n}\r\n.el-pagination {\r\n    margin-top: 15px;\r\n    float: right;\r\n}\r\n.el-select {\r\n    margin-left: 15px;\r\n    margin-right: 15px;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}