{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport layout from '@/components/layout-page.vue';\nimport Seat from \"@/components/Seat\";\nimport { getStudyRoom, renewStudyRoom, addStudyRoom, deleteStudyRoom } from '@/api/request';\nexport default {\n  components: {\n    layout,\n    Seat\n  },\n\n  data() {\n    return {\n      currentPage: 1,\n      pagesize: 10,\n      total: 10,\n      tableData: [],\n      Visible: false,\n      seatRows: null,\n      blankRows: [],\n      addVisible: false,\n      deleteVisible: false,\n      bookingVal: '',\n      bookingInfo: [],\n      form: {\n        index: '',\n        stuRoomNumber: '',\n        buildingNumber: '',\n        classRoomNumber: '',\n        openStatus: '',\n        time: '',\n        returnTime: []\n      },\n      open: true,\n      status: ''\n    };\n  },\n\n  props: {\n    item: {\n      type: Object\n    },\n    color: {\n      type: String\n    }\n  },\n  methods: {\n    handleCurrentChange(page) {\n      this.currentPage = page;\n      this.query();\n    },\n\n    query() {\n      getStudyRoom().then(res => {\n        if (res) {\n          this.tableData = res;\n\n          for (let i in res) {\n            if (res[i].openStatus) this.tableData[i].openStatus = \"是\";else this.tableData[i].openStatus = \"否\"; // console.log(this.tableData[i].openStatus)\n          }\n\n          this.total = res.length;\n        }\n      });\n    },\n\n    chooseRoom(val) {\n      // val.stuRoomNumber\n      this.Visible = true;\n    },\n\n    getColor(state) {\n      if (state === 0) return '#31af0a';else if (state === 1) {\n        return '#808080';\n      } else {\n        return '#d05c43';\n      }\n    },\n\n    seatClick(index) {\n      if (this.seatRows[index].type === 1 || this.seatRows[index].state === 2 || this.seatRows[index].state === 1) {\n        this.seatRows[index].show = false;\n        return;\n      }\n\n      this.seatCurIndex = index;\n    },\n\n    sure() {\n      if (this.form.openStatus == \"是\" && !this.form.time) {\n        this.$message.info('请选择自习室开放时间和结束时间！');\n        return;\n      }\n\n      if (!this.form.time) {\n        this.form.time = [null, null]; //灰色\n      }\n\n      if (this.form.openStatus == \"是\" || this.form.openStatus == \"true\") this.open = true;else this.open = false;\n      let data = {\n        // id: this.form.index,\n        stuRoomNumber: this.form.stuRoomNumber,\n        buildingNumber: this.form.buildingNumber,\n        classRoomNumber: this.form.classRoomNumber,\n        openStatus: this.open,\n        startTime: this.form.time[0],\n        endTime: this.form.time[1]\n      };\n      renewStudyRoom(data).then(res => {\n        this.Visible = false; // 刷新页面\n\n        this.form = {\n          index: '',\n          stuRoomNumber: '',\n          buildingNumber: '',\n          classRoomNumber: '',\n          openStatus: '',\n          time: '',\n          returnTime: []\n        };\n        this.$message.success('更新成功');\n        getStudyRoom().then(res => {\n          if (res) {\n            this.tableData = res;\n\n            for (let i in res) {\n              if (res[i].openStatus) this.tableData[i].openStatus = \"是\";else this.tableData[i].openStatus = \"否\";\n            }\n\n            this.total = res.length;\n          }\n        });\n      }).catch(err => {\n        console.log(err);\n        this.$message.success('更新失败');\n      });\n    },\n\n    add() {\n      this.addVisible = true;\n    },\n\n    addSure() {\n      if (this.form.openStatus == \"是\" && !this.form.time) {\n        this.$message.info('请选择自习室开放时间和结束时间！');\n        return;\n      }\n\n      if (!this.form.time) {\n        this.form.time = [null, null]; //灰色\n      } // console.log(this.form.openStatus)\n\n\n      if (this.form.openStatus == \"是\" || this.form.openStatus == \"true\") this.open = true;else this.open = false;\n      let data = {\n        // id: this.form.index,\n        stuRoomNumber: this.form.stuRoomNumber,\n        buildingNumber: this.form.buildingNumber,\n        classRoomNumber: this.form.classRoomNumber,\n        openStatus: this.open,\n        startTime: this.form.time[0],\n        endTime: this.form.time[1]\n      };\n      console.log(data);\n      addStudyRoom(data).then(res => {\n        this.addVisible = false; // 刷新页面\n\n        this.form = {\n          index: '',\n          stuRoomNumber: '',\n          buildingNumber: '',\n          classRoomNumber: '',\n          openStatus: '',\n          time: '',\n          returnTime: []\n        };\n        this.$message.success('更新成功');\n        getStudyRoom().then(res => {\n          if (res) {\n            this.tableData = res;\n\n            for (let i in res) {\n              if (res[i].openStatus) this.tableData[i].openStatus = \"是\";else this.tableData[i].openStatus = \"否\";\n            }\n\n            this.total = res.length;\n          }\n        });\n      }).catch(err => {\n        console.log(err);\n        this.$message.success('更新失败');\n      });\n    },\n\n    deleteRoom(val) {\n      this.form.stuRoomNumber = val.stuRoomNumber;\n      this.deleteVisible = true;\n    },\n\n    deleteSure(data) {\n      // console.log(data)\n      deleteStudyRoom(data).then(res => {\n        this.deleteVisible = false; // 刷新页面\n\n        this.form = {\n          index: '',\n          stuRoomNumber: '',\n          buildingNumber: '',\n          classRoomNumber: '',\n          openStatus: '',\n          time: '',\n          returnTime: []\n        };\n        this.$message.success('删除成功');\n        getStudyRoom().then(res => {\n          if (res) {\n            this.tableData = res;\n\n            for (let i in res) {\n              if (res[i].openStatus) this.tableData[i].openStatus = \"是\";else this.tableData[i].openStatus = \"否\";\n            }\n\n            this.total = res.length;\n          }\n        });\n      }).catch(err => {\n        console.log(err);\n        this.$message.success('删除失败');\n      });\n    }\n\n  },\n\n  mounted() {\n    this.query();\n  }\n\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0CA;AACA;AACA;AAEA;EACAA;IACAC,MADA;IACAC;EADA,CADA;;EAIAC;IACA;MACAC,cADA;MAEAC,YAFA;MAGAC,SAHA;MAIAC,aAJA;MAKAC,cALA;MAMAC,cANA;MAOAC,aAPA;MAQAC,iBARA;MASAC,oBATA;MAUAC,cAVA;MAWAC,eAXA;MAYAC;QACAC,SADA;QAEAC,iBAFA;QAGAC,kBAHA;QAIAC,mBAJA;QAKAC,cALA;QAMAC,QANA;QAOAC;MAPA,CAZA;MAqBAC,UArBA;MAsBAC;IAtBA;EAwBA,CA7BA;;EA8BAC;IACAC;MACAC;IADA,CADA;IAIAC;MACAD;IADA;EAJA,CA9BA;EAsCAE;IACAC;MACA;MACA;IACA,CAJA;;IAKAC;MACAC;QACA;UACA;;UACA;YACA,+DACA,mCAFA,CAGA;UACA;;UACA;QACA;MACA,CAVA;IAWA,CAjBA;;IAkBAC;MACA;MACA;IACA,CArBA;;IAsBAC;MACA,iBACA,iBADA,KAEA;QACA;MACA,CAFA,MAEA;QACA;MACA;IACA,CA9BA;;IA+BAC;MACA;QACA;QACA;MACA;;MACA;IACA,CArCA;;IAsCAC;MACA;QACA;QACA;MACA;;MACA;QACA,8BADA,CACA;MACA;;MACA,yFACA;MACA;QACA;QACAnB,sCAFA;QAGAC,wCAHA;QAIAC,0CAJA;QAKAC,qBALA;QAMAiB,4BANA;QAOAC;MAPA;MASAC;QACA,qBADA,CAEA;;QACA;UACAvB,SADA;UAEAC,iBAFA;UAGAC,kBAHA;UAIAC,mBAJA;UAKAC,cALA;UAMAC,QANA;UAOAC;QAPA;QASA;QACAU;UACA;YACA;;YACA;cACA,+DACA;YACA;;YACA;UACA;QACA,CATA;MAUA,CAvBA,EAuBAQ,KAvBA,CAuBAC;QACAC;QACA;MACA,CA1BA;IA2BA,CApFA;;IAqFAC;MACA;IACA,CAvFA;;IAwFAC;MACA;QACA;QACA;MACA;;MACA;QACA,8BADA,CACA;MACA,CAPA,CAQA;;;MACA,yFACA;MACA;QACA;QACA3B,sCAFA;QAGAC,wCAHA;QAIAC,0CAJA;QAKAC,qBALA;QAMAiB,4BANA;QAOAC;MAPA;MASAI;MACAG;QACA,wBADA,CAEA;;QACA;UACA7B,SADA;UAEAC,iBAFA;UAGAC,kBAHA;UAIAC,mBAJA;UAKAC,cALA;UAMAC,QANA;UAOAC;QAPA;QASA;QACAU;UACA;YACA;;YACA;cACA,+DACA;YACA;;YACA;UACA;QACA,CATA;MAUA,CAvBA,EAuBAQ,KAvBA,CAuBAC;QACAC;QACA;MACA,CA1BA;IA2BA,CAxIA;;IAyIAI;MACA;MACA;IACA,CA5IA;;IA6IAC;MACA;MACAC;QACA,2BADA,CAEA;;QACA;UACAhC,SADA;UAEAC,iBAFA;UAGAC,kBAHA;UAIAC,mBAJA;UAKAC,cALA;UAMAC,QANA;UAOAC;QAPA;QASA;QACAU;UACA;YACA;;YACA;cACA,+DACA;YACA;;YACA;UACA;QACA,CATA;MAUA,CAvBA,EAuBAQ,KAvBA,CAuBAC;QACAC;QACA;MACA,CA1BA;IA2BA;;EA1KA,CAtCA;;EAkNAO;IACA;EACA;;AApNA","names":["components","layout","Seat","data","currentPage","pagesize","total","tableData","Visible","seatRows","blankRows","addVisible","deleteVisible","bookingVal","bookingInfo","form","index","stuRoomNumber","buildingNumber","classRoomNumber","openStatus","time","returnTime","open","status","props","item","type","color","methods","handleCurrentChange","query","getStudyRoom","chooseRoom","getColor","seatClick","sure","startTime","endTime","renewStudyRoom","catch","err","console","add","addSure","addStudyRoom","deleteRoom","deleteSure","deleteStudyRoom","mounted"],"sourceRoot":"src/views","sources":["booking.vue"],"sourcesContent":["<template>\r\n    <layout>\r\n        <div>\r\n            <el-button type=\"primary\" @click=\"query\">查询</el-button>\r\n            <el-table :data=\"tableData\" border style=\"width: 100%\">\r\n                <el-table-column type=\"index\" label=\"序号\" align=\"center\" width=\"55px\" />\r\n                <el-table-column prop=\"stuRoomNumber\" label=\"编号\" align=\"center\" />\r\n                <el-table-column prop=\"buildingNumber\" label=\"所处楼栋\" align=\"center\" />\r\n                <el-table-column prop=\"classRoomNumber\" label=\"所处教室\" align=\"center\"/>\r\n                <el-table-column prop=\"openStatus\" label=\"是否开放\" align=\"center\"/>\r\n                <el-table-column prop=\"startTime\" type=\"datatime\" label=\"开放时间\" align=\"center\"/>\r\n                <el-table-column prop=\"endTime\" type=\"datatime\" label=\"关闭时间\" align=\"center\"/>\r\n                <el-table-column\r\n                    fixed=\"right\"\r\n                    label=\"操作\"\r\n                    align=\"center\"\r\n                    width=\"100\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-button @click=\"chooseRoom(scope.row)\" type=\"text\" size=\"small\">选择</el-button>\r\n                    </template>\r\n                </el-table-column>\r\n            </el-table>\r\n            <el-pagination\r\n                @current-change=\"handleCurrentChange\"\r\n                :current-page=\"currentPage\"\r\n                :page-size=\"10\"\r\n                layout=\"total, prev, pager, next, jumper\"\r\n                :total=\"total\">\r\n            </el-pagination>\r\n            <el-dialog title=\"预约\" :visible.sync=\"Visible\" width=\"520px\">\r\n                <svg style=\"pointer-events: none;transform: scale(0.8);margin-top: 4px\" viewBox=\"0 0 1024 1024\"\r\n                    xmlns=\"http://www.w3.org/2000/svg\"\r\n                    width=\"26\" height=\"26\" fill=\"#31af0a\">\r\n                    <path\r\n                        d=\"M695.843721 187.320558c32.506047 0 54.343442 8.096744 65.488372 24.290233 11.192558 16.193488 16.765023 41.245767 16.765023 75.156837v231.30493c0 28.529116-6.096372 51.676279-18.265302 69.393861-12.192744 17.741395-35.197023 26.600186-69.060465 26.600186H383.166512c-32.482233 0-55.17693-8.477767-68.036465-25.433303-12.859535-16.955535-19.289302-43.960558-19.289303-80.967442v-220.898232c0-32.386977 6.096372-57.034419 18.289116-74.013768 12.16893-16.955535 34.863628-25.433302 68.012652-25.433302h313.725023z m127.952372 491.75814V355.947163c0-17.884279 5.23907-30.815256 15.717209-38.769116 10.501953-7.95386 23.528186-11.906977 39.102512-11.906977h46.699163c19.622698 0 32.64893 5.953488 39.078697 17.860465 6.429767 11.954605 9.644651 24.218791 9.644652 36.792558V789.432558c0 39.769302-19.622698 59.653953-58.868093 59.653954h-35.530419v87.492465h-64.988279v-87.492465H260.310326v87.492465H196.346047v-87.492465H155.743256c-35.863814 0-54.486326-20.551442-55.843721-61.630512V354.970791c0-16.574512 5.072372-29.005395 15.24093-37.292651 10.144744-8.287256 23.004279-12.430884 38.578605-12.430884h39.57879c19.646512 0 34.03014 5.143814 43.150884 15.407628 9.144558 10.287628 14.050233 23.694884 14.717023 40.269395v21.885023c0 10.597209-0.166698 23.694884-0.476279 39.26921a2370.67907 2370.67907 0 0 0-0.523907 51.2v205.800186h573.630512z\"\r\n                        :fill=\"getColor(item.state)\"></path>\r\n                </svg>\r\n            </el-dialog>\r\n        </div>\r\n    </layout>\r\n</template>\r\n<script>\r\nimport layout from '@/components/layout-page.vue'\r\nimport Seat from \"@/components/Seat\";\r\nimport { getStudyRoom, renewStudyRoom, addStudyRoom, deleteStudyRoom } from '@/api/request'\r\n\r\nexport default ({\r\n    components: {\r\n        layout, Seat\r\n    },\r\n    data() {\r\n      return {\r\n        currentPage: 1,\r\n        pagesize: 10,\r\n        total: 10,\r\n        tableData: [],\r\n        Visible: false,\r\n        seatRows: null,\r\n        blankRows: [],\r\n        addVisible: false,\r\n        deleteVisible: false,\r\n        bookingVal: '',\r\n        bookingInfo: [],\r\n        form: {\r\n            index: '',\r\n            stuRoomNumber: '',\r\n            buildingNumber: '',\r\n            classRoomNumber: '',\r\n            openStatus: '',\r\n            time: '',\r\n            returnTime:[],\r\n        },\r\n        open: true,\r\n        status: '',\r\n      }\r\n    },\r\n    props: {\r\n      item: {\r\n        type: Object\r\n      },\r\n      color: {\r\n        type: String\r\n      }\r\n    },\r\n    methods: {\r\n        handleCurrentChange(page) {\r\n            this.currentPage = page\r\n            this.query()\r\n        },\r\n        query() {\r\n            getStudyRoom().then((res) => {\r\n                if(res) {\r\n                    this.tableData = res\r\n                    for (let i in res) {\r\n                        if (res[i].openStatus) this.tableData[i].openStatus = \"是\"\r\n                        else this.tableData[i].openStatus = \"否\"\r\n                        // console.log(this.tableData[i].openStatus)\r\n                    }\r\n                    this.total = res.length\r\n                } \r\n            })\r\n        },\r\n        chooseRoom(val){\r\n            // val.stuRoomNumber\r\n            this.Visible = true\r\n        },\r\n        getColor(state) {\r\n            if (state === 0)\r\n            return '#31af0a'\r\n            else if (state === 1) {\r\n            return '#808080'\r\n            } else {\r\n            return '#d05c43'\r\n            }\r\n        },\r\n        seatClick(index) {\r\n            if (this.seatRows[index].type === 1 || this.seatRows[index].state === 2 || this.seatRows[index].state === 1) {\r\n                this.seatRows[index].show = false;\r\n                return\r\n            }\r\n            this.seatCurIndex = index\r\n        },\r\n        sure() {\r\n            if( this.form.openStatus==\"是\" && !this.form.time) {\r\n                this.$message.info('请选择自习室开放时间和结束时间！')\r\n                return\r\n            }\r\n            if(!this.form.time){\r\n                this.form.time = [null, null]//灰色\r\n            }\r\n            if (this.form.openStatus == \"是\"||this.form.openStatus==\"true\") this.open = true\r\n            else this.open=false\r\n            let data = {\r\n                // id: this.form.index,\r\n                stuRoomNumber: this.form.stuRoomNumber,\r\n                buildingNumber: this.form.buildingNumber,\r\n                classRoomNumber: this.form.classRoomNumber,\r\n                openStatus: this.open,\r\n                startTime: this.form.time[0],\r\n                endTime: this.form.time[1],\r\n            }\r\n            renewStudyRoom(data).then((res) => {\r\n                this.Visible = false\r\n                // 刷新页面\r\n                this.form = {\r\n                        index: '',\r\n                        stuRoomNumber: '',\r\n                        buildingNumber: '',\r\n                        classRoomNumber: '',\r\n                        openStatus: '',\r\n                        time: '',\r\n                        returnTime:[],\r\n                }\r\n                this.$message.success('更新成功')\r\n                getStudyRoom().then((res) => {\r\n                if(res) {\r\n                    this.tableData = res\r\n                    for (let i in res) {\r\n                        if (res[i].openStatus) this.tableData[i].openStatus = \"是\"\r\n                        else this.tableData[i].openStatus = \"否\"\r\n                    }\r\n                    this.total = res.length\r\n                } \r\n            })\r\n            }).catch(err=>{\r\n                console.log(err)\r\n                this.$message.success('更新失败')\r\n            })\r\n        },\r\n        add(){\r\n            this.addVisible = true\r\n        },\r\n        addSure(){\r\n            if( this.form.openStatus==\"是\" && !this.form.time) {\r\n                this.$message.info('请选择自习室开放时间和结束时间！')\r\n                return\r\n            }\r\n            if(!this.form.time){\r\n                this.form.time = [null, null]//灰色\r\n            }\r\n            // console.log(this.form.openStatus)\r\n            if (this.form.openStatus == \"是\"||this.form.openStatus==\"true\") this.open = true\r\n            else this.open=false\r\n            let data = {\r\n                // id: this.form.index,\r\n                stuRoomNumber: this.form.stuRoomNumber,\r\n                buildingNumber: this.form.buildingNumber,\r\n                classRoomNumber: this.form.classRoomNumber,\r\n                openStatus: this.open,\r\n                startTime: this.form.time[0],\r\n                endTime: this.form.time[1],\r\n            }\r\n            console.log(data)\r\n            addStudyRoom(data).then((res) => {\r\n                this.addVisible = false\r\n                // 刷新页面\r\n                this.form = {\r\n                        index: '',\r\n                        stuRoomNumber: '',\r\n                        buildingNumber: '',\r\n                        classRoomNumber: '',\r\n                        openStatus: '',\r\n                        time: '',\r\n                        returnTime:[],\r\n                }\r\n                this.$message.success('更新成功')\r\n                getStudyRoom().then((res) => {\r\n                if(res) {\r\n                    this.tableData = res\r\n                    for (let i in res) {\r\n                        if (res[i].openStatus) this.tableData[i].openStatus = \"是\"\r\n                        else this.tableData[i].openStatus = \"否\"\r\n                    }\r\n                    this.total = res.length\r\n                } \r\n            })\r\n            }).catch(err=>{\r\n                console.log(err)\r\n                this.$message.success('更新失败')\r\n            })\r\n        },\r\n        deleteRoom(val){\r\n            this.form.stuRoomNumber = val.stuRoomNumber\r\n            this.deleteVisible = true\r\n        },\r\n        deleteSure(data){\r\n            // console.log(data)\r\n            deleteStudyRoom(data).then((res) => {\r\n                this.deleteVisible = false\r\n                // 刷新页面\r\n                this.form = {\r\n                        index: '',\r\n                        stuRoomNumber: '',\r\n                        buildingNumber: '',\r\n                        classRoomNumber: '',\r\n                        openStatus: '',\r\n                        time: '',\r\n                        returnTime:[],\r\n                }\r\n                this.$message.success('删除成功')\r\n                getStudyRoom().then((res) => {\r\n                if(res) {\r\n                    this.tableData = res\r\n                    for (let i in res) {\r\n                        if (res[i].openStatus) this.tableData[i].openStatus = \"是\"\r\n                        else this.tableData[i].openStatus = \"否\"\r\n                    }\r\n                    this.total = res.length\r\n                } \r\n            })\r\n            }).catch(err=>{\r\n                console.log(err)\r\n                this.$message.success('删除失败')\r\n            })\r\n        }\r\n    },\r\n    mounted() {\r\n        this.query()\r\n    },\r\n})\r\n</script>\r\n<style scoped>\r\n.el-table {\r\n    margin-top: 15px;\r\n}\r\n.el-pagination {\r\n    margin-top: 15px;\r\n    float: right;\r\n}\r\n.item {\r\n  width: 32px;\r\n  height: 32px;\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}