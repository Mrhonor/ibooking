{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport layout from '@/components/layout-page.vue';\nimport { getStuBook, bookingDel, bookingCheck } from '@/api/request';\nexport default {\n  components: {\n    layout\n  },\n\n  data() {\n    return {\n      currentPage: 1,\n      pagesize: 10,\n      total: 10,\n      tableData: [],\n      testdata: [{\n        \"id\": 1,\n        \"seatId\": 1,\n        \"startTime\": \"2023-05-29 10:00\",\n        \"endTime\": \"2023-05-29 12:00\",\n        \"isEnd\": false,\n        \"isTimeout\": false,\n        \"stuNum\": \"01010101\",\n        \"name\": \"John Doe\",\n        \"buildingNum\": \"Building1\",\n        \"classRoomNum\": \"Class1\"\n      }]\n    };\n  },\n\n  methods: {\n    handleCurrentChange(page) {\n      this.currentPage = page;\n      this.query();\n    },\n\n    query() {\n      const stuNum = 1; // getStuBook(stuNum).then((res) => {\n      //     if(res) {\n\n      let res = this.testdata; // console.log(res)\n\n      if (!res.length) {\n        this.tableData = [res];\n      } else {\n        this.tableData = res;\n      }\n\n      for (let i in res) {\n        let st = new Date(this.tableData[i].startTime);\n        let d = st.getDate();\n        let y = st.getFullYear();\n        let mon = st.getMonth() + 1;\n        let h = st.getHours();\n        let m = new Date(st).getMinutes();\n        let s = new Date(st).getSeconds();\n        let start = h + ':' + m + ':' + s; // console.log(y+'-'+ mon +'-'+d)\n\n        this.tableData[i].day = y + '-' + mon + '-' + d;\n        this.tableData[i].start = start;\n        let et = new Date(this.tableData[i].endTime);\n        let eh = et.getHours();\n        let em = et.getMinutes();\n        let es = et.getSeconds();\n        let end = eh + ':' + em + ':' + es;\n        this.tableData[i].end = end;\n      } // console.log('最后的',this.tableData)\n      // this.total = res.length\n      //     } \n      // })\n\n    },\n\n    timeToBook(val) {\n      let now = new Date();\n      if (val.startTime > now + 60 * 15 * 1000 || val.startTime + 60 * 5 * 1000 < now) return false;else return true;\n    },\n\n    bookStu(val) {\n      bookingCheck(val.stuNum).then(res => {\n        if (res) {\n          this.$message.success('签到成功');\n        } else {\n          this.$message.success('已超过签退时间，签到失败！');\n        }\n      });\n    },\n\n    unbookStu(val) {\n      this.$confirm('确定要退预约吗?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        let data = {\n          id: val.id,\n          seatId: val.seatId,\n          startTime: val.startTime,\n          endTime: val.endTime,\n          isEnd: val.isEnd,\n          isTimeout: val.isTimeout,\n          stuNum: val.stuNum,\n          name: val.name,\n          buildingNum: val.buildingNum,\n          classRoomNum: val.val.classRoomNum\n        };\n        bookingDel(data).then(res => {\n          if (res) {\n            this.query();\n            this.$message.success('退预约成功');\n          } else {\n            this.$message.success('退预约失败');\n          }\n        });\n      }).catch(() => {\n        this.$message.info('已取消');\n      });\n    }\n\n  },\n\n  mounted() {\n    this.query();\n  }\n\n};","map":null,"metadata":{},"sourceType":"module"}