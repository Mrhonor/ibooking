{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport layout from '@/components/layout-page.vue';\nimport { getSeat, deleteSeat, addSeat, getAllSeat } from '@/api/request';\nexport default {\n  components: {\n    layout\n  },\n\n  data() {\n    return {\n      currentPage: 1,\n      pagesize: 10,\n      total: 10,\n      tableData: [],\n      addVisible: false,\n      form: {\n        seatNum: '',\n        studyRoomId: '',\n        hasOutlet: '',\n        isVacant: true,\n        time: []\n      },\n      labelPosition: \"top\",\n      has: 1\n    };\n  },\n\n  methods: {\n    handleCurrentChange(page) {\n      this.currentPage = page;\n      this.query();\n    },\n\n    find() {\n      let roomNum = this.$route.query.roomnum;\n      return !roomNum;\n    },\n\n    query() {\n      let roomNum = this.$route.query.roomnum;\n\n      if (!roomNum) {\n        getAllSeat().then(res => {\n          if (res) {\n            if (!res.length) {\n              this.tableData = [res];\n            } else {\n              this.tableData = res;\n            }\n\n            for (let i in res) {\n              this.tableData[i] = res[i];\n              if (res[i].isVacant) this.tableData[i].is_Vacant = \"是\";else this.tableData[i].is_Vacant = \"否\";\n              if (res[i].hasOutlet) this.tableData[i].has_Outlet = \"是\";else this.tableData[i].has_Outlet = \"否\";\n              console.log(res[i].hasOutlet);\n            }\n\n            this.total = res.length;\n          }\n        });\n      } else {\n        getSeat(roomNum).then(res => {\n          if (res) {\n            this.tableData = res;\n\n            for (let i in res) {\n              if (res[i].isVacant) {\n                this.tableData[i].is_Vacant = \"是\";\n              } else {\n                this.tableData[i].is_Vacant = \"否\";\n              }\n\n              if (res[i].hasOutlet) this.tableData[i].has_Outlet = \"是\";else this.tableData[i].has_Outlet = \"否\"; // console.log(this.tableData[i].openStatus)\n            } // this.is_Vacant = \n\n\n            this.total = res.length;\n          }\n        });\n      }\n    },\n\n    add() {\n      this.addVisible = true;\n    },\n\n    delSeat(val) {\n      this.$confirm('确定要删除这个座位吗?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        // console.log(typeof val.seatNum)\n        let data = {\n          id: val.id\n        };\n        deleteSeat(data).then(res => {\n          this.query();\n          this.$message.success('删除成功');\n        });\n      }).catch(() => {\n        this.$message.info('已取消');\n      });\n    },\n\n    sure() {\n      if (!this.form.seatNum || !this.form.time) {\n        this.$message.info('请填写座位编号、开放时间和结束时间！');\n        return;\n      } // console.log(this.form.hasOutlet)\n\n\n      if (this.form.hasOutlet) {\n        this.has = 1;\n      } else {\n        this.has = 0;\n      }\n\n      let data = {\n        seatNum: parseInt(this.form.seatNum),\n        studyRoomId: parseInt(this.form.studyRoomId),\n        start: this.form.time[0],\n        end: this.form.time[1],\n        hasOutlet: this.has,\n        isVacant: 1\n      }; // console.log(data)\n\n      addSeat(data).then(res => {\n        this.addVisible = false;\n        this.form = {\n          seatNum: '',\n          studyRoomId: '',\n          hasOutlet: '',\n          isVacant: true,\n          time: []\n        };\n        this.query();\n        this.$message.success('更新成功'); // console.log(res)\n      }).catch(err => {\n        console.log(err);\n        this.$message.success('更新失败');\n      });\n    }\n\n  },\n\n  mounted() {\n    this.query();\n  }\n\n};","map":null,"metadata":{},"sourceType":"module"}