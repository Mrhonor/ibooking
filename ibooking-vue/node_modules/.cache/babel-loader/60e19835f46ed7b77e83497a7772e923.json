{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport layout from '@/components/layout-page.vue';\nimport { getSeatBook, booking } from '@/api/request';\nimport BookChooseRoom from './book-chooseRoom.vue';\nexport default {\n  components: {\n    layout\n  },\n\n  data() {\n    return {\n      currentPage: 1,\n      pagesize: 10,\n      total: 10,\n      tableData: [],\n      active: 2,\n      pickerOptions1: {\n        //   disabledDate(time) {\n        //     return time.getTime() < Date.now()-3600 * 1000 * 24;\n        //   },\n        shortcuts: [{\n          text: '今天',\n\n          onClick(picker) {\n            picker.$emit('pick', new Date());\n          }\n\n        }, {\n          text: '明天',\n\n          onClick(picker) {\n            const date = new Date();\n            date.setTime(date.getTime() + 3600 * 1000 * 24);\n            picker.$emit('pick', date);\n          }\n\n        }, {\n          text: '后天',\n\n          onClick(picker) {\n            const date = new Date();\n            date.setTime(date.getTime() + 3600 * 1000 * 24 * 2);\n            picker.$emit('pick', date);\n          }\n\n        }]\n      },\n      value2: '',\n      chooseDd: '',\n      seatNum: this.$route.query.seatnum,\n      roomNum: this.$route.query.roomnum,\n      start: this.$route.query.st,\n      end: this.$route.query.et,\n      startTime: '',\n      endTime: '',\n      timeLimite: '',\n      form: {\n        index: '',\n        stuRoomNumber: '',\n        buildingNumber: '',\n        classRoomNumber: '',\n        openStatus: '',\n        time: '',\n        returnTime: []\n      },\n      open: true\n    };\n  },\n\n  methods: {\n    handleCurrentChange(page) {\n      this.currentPage = page;\n      this.query();\n    },\n\n    Limite(startTime) {\n      let min = parseInt(startTime.split(\":\")[1]) + 1;\n      this.timeLimite = (parseInt(startTime) + 4).toString().padStart(2, '0') + \":\" + min.toString().padStart(2, '0');\n    },\n\n    next() {\n      if (this.active++ > 3) this.active = 0;\n    },\n\n    query() {\n      getSeatBook(this.seatNum).then(res => {\n        if (res) {\n          this.tableData = [];\n\n          for (let i in res) {\n            let d = new Date(res[i].startTime);\n            let day = d.getDate();\n            let year = d.getFullYear();\n            let mon = d.getMonth() + 1;\n            let dd = year + \"-\" + mon + \"-\" + day;\n            day = this.value2.getDate();\n            year = this.value2.getFullYear();\n            mon = this.value2.getMonth() + 1;\n            this.chooseDd = year + \"-\" + mon + \"-\" + day;\n            console.log(dd, chooseDd);\n\n            if (dd == this.chooseDd) {\n              this.tableData.push(res[i]);\n            }\n          }\n\n          this.total = res.length;\n        }\n      });\n    },\n\n    sure() {\n      if (!this.startTime || !this.endTime) {\n        this.$message.info('请选择预约开始时间和结束时间！');\n        return;\n      }\n\n      let start = this.chooseDd + ' ' + this.startTime + ':00';\n      let end = this.chooseDd + ' ' + this.endTime + ':00';\n      console.log(typeof start, start);\n      let data = {\n        // id: this.form.index,\n        seatNum: this.seatNum,\n        startTime: start,\n        endTime: end,\n        SignIn: false,\n        isEnd: false,\n        isTimeout: false\n      };\n      booking(data).then(res => {\n        console.log(res);\n        this.$message.success('预约成功');\n        next();\n      }).catch(err => {\n        console.log(err);\n        this.$message.success('预约失败');\n      });\n    },\n\n    renew() {\n      this.valu2 = '';\n      this.startTime = '';\n      this.endTime = '';\n      this.timeLimite = '';\n      this.chooseDd = '';\n    }\n\n  },\n\n  mounted() {\n    this.query();\n  }\n\n};","map":null,"metadata":{},"sourceType":"module"}