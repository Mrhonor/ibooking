{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport layout from '@/components/layout-page.vue';\nimport { getStudent, booking, bookingCheck } from '@/api/request';\nexport default {\n  components: {\n    layout\n  },\n\n  data() {\n    return {\n      currentPage: 1,\n      pagesize: 10,\n      total: 10,\n      tableData: [],\n      Visible: false,\n      bookingVal: '',\n      bookingInfo: [],\n      form: {\n        time: ''\n      }\n    };\n  },\n\n  methods: {\n    handleCurrentChange(page) {\n      this.currentPage = page;\n      this.query();\n    },\n\n    query() {\n      getStudent().then(res => {\n        if (res) {\n          this.tableData = res;\n          this.total = res.length;\n        }\n      });\n    },\n\n    done(val) {\n      const params = val.stuNum;\n      bookingCheck(params).then(res => {\n        if (res) {\n          this.$message.success('签到成功');\n          this.bookingInfo = res['预约信息'];\n        } else {\n          this.$message.success('签到失败');\n        }\n      });\n    },\n\n    booking(val) {\n      this.bookingVal = val;\n      this.Visible = true;\n    },\n\n    check(val) {\n      this.$router.push({\n        path: '/account',\n        query: {\n          stuNum: val.stuNum\n        }\n      });\n    },\n\n    sure() {\n      if (!this.form.time) {\n        this.$message.info('请选择预约开始时间和结束时间');\n        return;\n      }\n\n      let currentDate = new Date();\n      let strDate = currentDate.getFullYear() + \"-\" + (currentDate.getMonth() + 1) + \"-\" + currentDate.getDate();\n      const params = {\n        beginTime: this.form.time[0],\n        endTime: this.form.time[1],\n        bookingDate: strDate,\n        done: true,\n        id: this.bookingVal.id,\n        seatId: 0,\n        stuNum: this.bookingVal.stuNum\n      };\n      booking(params).then(res => {\n        if (res && res.code == 0) {\n          this.Visible = false;\n          this.form = {\n            time: ''\n          };\n          this.$message.success('预约成功');\n        } else {\n          this.$message.success('预约失败');\n        }\n      });\n    }\n\n  },\n\n  mounted() {\n    this.query();\n  }\n\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmDA;AACA;AAEA;EACAA;IACAC;EADA,CADA;;EAIAC;IACA;MACAC,cADA;MAEAC,YAFA;MAGAC,SAHA;MAIAC,aAJA;MAKAC,cALA;MAMAC,cANA;MAOAC,eAPA;MAQAC;QACAC;MADA;IARA;EAYA,CAjBA;;EAkBAC;IACAC;MACA;MACA;IACA,CAJA;;IAKAC;MACAC;QACA;UACA;UACA;QACA;MACA,CALA;IAMA,CAZA;;IAaAC;MACA;MACAC;QACA;UACA;UACA;QAEA,CAJA,MAIA;UACA;QACA;MACA,CARA;IASA,CAxBA;;IAyBAC;MACA;MACA;IACA,CA5BA;;IA6BAC;MACA;QAAAC;QAAAN;UAAAO;QAAA;MAAA;IACA,CA/BA;;IAgCAC;MACA;QACA;QACA;MACA;;MACA;MACA;MACA;QACAC,4BADA;QAEAC,0BAFA;QAGAC,oBAHA;QAIAT,UAJA;QAKAU,sBALA;QAMAC,SANA;QAOAN;MAPA;MAUAH;QACA;UACA;UACA;YACAP;UADA;UAGA;QACA,CANA,MAMA;UACA;QACA;MACA,CAVA;IAWA;;EA5DA,CAlBA;;EAkFAiB;IACA;EACA;;AApFA","names":["components","layout","data","currentPage","pagesize","total","tableData","Visible","bookingVal","bookingInfo","form","time","methods","handleCurrentChange","query","getStudent","done","bookingCheck","booking","check","path","stuNum","sure","beginTime","endTime","bookingDate","id","seatId","mounted"],"sourceRoot":"src/views","sources":["user-management.vue"],"sourcesContent":["<template>\r\n    <layout>\r\n        <div>\r\n            <el-button type=\"primary\" @click=\"query\">查询</el-button>\r\n            <el-table :data=\"tableData\" border style=\"width: 100%\">\r\n                <el-table-column type=\"index\" label=\"序号\" align=\"center\" width=\"55px\" />\r\n                <el-table-column prop=\"stuNum\" label=\"学号\" align=\"center\" />\r\n                <el-table-column prop=\"password\" label=\"密码\" align=\"center\"/>\r\n                <el-table-column prop=\"salt\" label=\"座位\" align=\"center\"/>\r\n                <el-table-column prop=\"registerTime\" label=\"注册时间\" align=\"center\"/>\r\n                <el-table-column\r\n                    fixed=\"right\"\r\n                    label=\"操作\"\r\n                    align=\"center\"\r\n                    width=\"100\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-button @click=\"done(scope.row)\" type=\"text\" size=\"small\">签到</el-button>\r\n                        <el-button @click=\"booking(scope.row)\" type=\"text\" size=\"small\">预约</el-button>\r\n                        <el-button @click=\"check(scope.row)\" type=\"text\" size=\"small\">查看</el-button>\r\n                    </template>\r\n                </el-table-column>\r\n            </el-table>\r\n            <el-pagination\r\n                @current-change=\"handleCurrentChange\"\r\n                :current-page=\"currentPage\"\r\n                :page-size=\"10\"\r\n                layout=\"total, prev, pager, next, jumper\"\r\n                :total=\"total\">\r\n            </el-pagination>\r\n            <el-dialog title=\"预约\" :visible.sync=\"Visible\" width=\"500px\">\r\n                <el-form :model=\"form\">\r\n                    <el-form-item label=\"预约时间\" >\r\n                      <el-date-picker\r\n                        v-model=\"form.time\"\r\n                        type=\"daterange\"\r\n                        range-separator=\"至\"\r\n                        start-placeholder=\"开始日期\"\r\n                        end-placeholder=\"结束日期\"\r\n                        value-format=\"yyyy-MM-dd HH:mm\">\r\n                        </el-date-picker>\r\n                    </el-form-item>\r\n                </el-form>\r\n                <span slot=\"footer\" class=\"dialog-footer\">\r\n                  <el-button type=\"primary\" @click=\"sure\">确 定</el-button>\r\n                  <el-button @click=\"dialogVisible = false\">取 消</el-button>\r\n                </span>\r\n            </el-dialog>\r\n        </div>\r\n    </layout>\r\n</template>\r\n<script>\r\nimport layout from '@/components/layout-page.vue'\r\nimport { getStudent, booking, bookingCheck} from '@/api/request'\r\n\r\nexport default ({\r\n    components: {\r\n        layout,\r\n    },\r\n    data() {\r\n      return {\r\n        currentPage: 1,\r\n        pagesize: 10,\r\n        total: 10,\r\n        tableData: [],\r\n        Visible: false,\r\n        bookingVal: '',\r\n        bookingInfo: [],\r\n        form: {\r\n            time: ''\r\n        }\r\n      }\r\n    },\r\n    methods: {\r\n        handleCurrentChange(page) {\r\n            this.currentPage = page\r\n            this.query()\r\n        },\r\n        query() {\r\n            getStudent().then((res) => {\r\n                if(res) {\r\n                  this.tableData = res\r\n                  this.total = res.length\r\n                } \r\n            })\r\n        },\r\n        done(val) {\r\n            const params = val.stuNum\r\n            bookingCheck(params).then((res) => {\r\n                if(res) {\r\n                    this.$message.success('签到成功')\r\n                    this.bookingInfo = res['预约信息']\r\n\r\n                } else {\r\n                    this.$message.success('签到失败')\r\n                }\r\n            })\r\n        },\r\n        booking(val) {\r\n            this.bookingVal = val\r\n            this.Visible = true\r\n        },\r\n        check(val) {\r\n            this.$router.push({ path: '/account', query: {stuNum: val.stuNum} })\r\n        },\r\n        sure() {\r\n            if( !this.form.time) {\r\n                this.$message.info('请选择预约开始时间和结束时间')\r\n                return\r\n            }\r\n            let currentDate = new Date();\r\n            let strDate = currentDate.getFullYear()+\"-\"+(currentDate.getMonth()+1)+\"-\"+currentDate.getDate();\r\n            const params = {\r\n                beginTime: this.form.time[0],\r\n                endTime: this.form.time[1],\r\n                bookingDate: strDate,\r\n                done: true,\r\n                id: this.bookingVal.id,\r\n                seatId: 0,\r\n                stuNum: this.bookingVal.stuNum\r\n                \r\n            }\r\n             booking(params).then((res) => {\r\n                if(res && res.code == 0) {\r\n                    this.Visible = false\r\n                    this.form = {\r\n                        time: ''\r\n                    }\r\n                    this.$message.success('预约成功')\r\n                } else {\r\n                    this.$message.success('预约失败')\r\n                }\r\n            })\r\n        }\r\n     \r\n\r\n    },\r\n    mounted() {\r\n        this.query()\r\n    },\r\n})\r\n</script>\r\n<style scoped>\r\n.el-table {\r\n    margin-top: 15px;\r\n}\r\n.el-pagination {\r\n    margin-top: 15px;\r\n    float: right;\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}