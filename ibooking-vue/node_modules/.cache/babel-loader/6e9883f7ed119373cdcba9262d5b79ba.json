{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport layout from '@/components/layout-page.vue';\nimport { getStudent, booking, bookingCheck } from '@/api/request';\nexport default {\n  components: {\n    layout\n  },\n\n  data() {\n    return {\n      currentPage: 1,\n      pagesize: 10,\n      total: 10,\n      tableData: [],\n      Visible: false,\n      bookingVal: '',\n      bookingInfo: [],\n      form: {\n        time: ''\n      }\n    };\n  },\n\n  methods: {\n    handleCurrentChange(page) {\n      this.currentPage = page;\n      this.query();\n    },\n\n    query() {\n      getStudent().then(res => {\n        if (res) {\n          this.tableData = res;\n          this.total = res.length;\n        }\n      });\n    },\n\n    done(val) {\n      const params = val.stuNum;\n      bookingCheck(params).then(res => {\n        if (res) {\n          this.$message.success('签到成功');\n          this.bookingInfo = res['预约信息'];\n          localStorage.setItem('bookingInfo', JSON.stringify(this.bookingInfo));\n        } else {\n          this.$message.success('签到失败');\n        }\n      });\n    },\n\n    booking(val) {\n      this.bookingVal = val;\n      this.Visible = true;\n    },\n\n    check() {\n      if (this.bookingInfo.length === 0) {\n        this.$message.info('请先进行签到或者预约,才能查看预约信息');\n        return;\n      }\n\n      this.$router.push({\n        name: 'account',\n        params: {\n          bookingInfo: this.bookingInfo\n        }\n      });\n    },\n\n    sure() {\n      if (!this.form.time) {\n        this.$message.info('请选择预约开始时间和结束时间');\n        return;\n      }\n\n      let currentDate = new Date();\n      let strDate = currentDate.getFullYear() + \"-\" + (currentDate.getMonth() + 1) + \"-\" + currentDate.getDate();\n      const params = {\n        beginTime: this.form.time[0],\n        endTime: this.form.time[1],\n        bookingDate: strDate,\n        done: true,\n        id: this.bookingVal.id,\n        seatId: 0,\n        stuNum: this.bookingVal.stuNum\n      };\n      booking(params).then(res => {\n        if (res && res.code == 0) {\n          this.Visible = false;\n          this.form = {\n            time: ''\n          };\n          this.bookingInfo = res['预约信息'];\n          localStorage.setItem('bookingInfo', JSON.stringify(this.bookingInfo));\n          this.$message.success('预约成功');\n        } else {\n          this.$message.success('预约失败');\n        }\n      });\n    }\n\n  },\n\n  mounted() {\n    this.query();\n  }\n\n};","map":null,"metadata":{},"sourceType":"module"}