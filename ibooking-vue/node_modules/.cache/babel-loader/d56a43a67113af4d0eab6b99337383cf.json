{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport layout from '@/components/layout-page.vue';\nimport { getSeat, deleteSeat, addSeat, getAllSeat } from '@/api/request';\nexport default {\n  components: {\n    layout\n  },\n\n  data() {\n    return {\n      currentPage: 1,\n      pagesize: 10,\n      total: 10,\n      tableData: [],\n      addVisible: false,\n      form: {\n        seatNum: '',\n        studyRoomId: '',\n        hasOutlet: '',\n        isVacant: true,\n        time: []\n      },\n      labelPosition: \"top\",\n      has: 1\n    };\n  },\n\n  methods: {\n    handleCurrentChange(page) {\n      this.currentPage = page;\n      this.query();\n    },\n\n    query() {\n      let roomNum = this.$route.query.roomnum;\n\n      if (!roomNum) {\n        getAllSeat().then(res => {\n          if (res) {\n            if (!res.length) {\n              this.tableData = [res];\n            } else {\n              this.tableData = res;\n            }\n\n            for (let i in res) {\n              this.tableData[i] = res[i];\n              if (res[i].isVacant) this.tableData[i].is_Vacant = \"是\";else this.tableData[i].is_Vacant = \"否\";\n              if (res[i].hasOutlet) this.tableData[i].has_Outlet = \"是\";else this.tableData[i].has_Outlet = \"否\";\n            }\n\n            this.total = res.length;\n          }\n        });\n      } else {\n        getSeat(roomNum).then(res => {\n          if (res) {\n            this.tableData = res;\n\n            for (let i in res) {\n              if (res[i].isVacant) {\n                this.tableData[i].is_Vacant = \"是\";\n              } else {\n                this.tableData[i].is_Vacant = \"否\";\n              }\n\n              if (res[i].hasOutlet) this.tableData[i].has_Outlet = \"是\";else this.tableData[i].has_Outlet = \"否\"; // console.log(this.tableData[i].openStatus)\n            } // this.is_Vacant = \n\n\n            this.total = res.length;\n          }\n        });\n      }\n    },\n\n    add() {\n      this.addVisible = true;\n    },\n\n    delSeat(val) {\n      this.$confirm('确定要删除这个座位吗?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        // console.log(typeof val.seatNum)\n        let data = {\n          id: val.id\n        };\n        deleteSeat(data).then(res => {\n          if (res) {\n            this.query();\n            this.$message.success('删除成功');\n          } else {\n            this.$message.success('删除失败');\n          }\n        });\n      }).catch(() => {\n        this.$message.info('已取消');\n      });\n    },\n\n    sure() {\n      if (!this.form.seatNum || !this.form.time) {\n        this.$message.info('请填写座位编号、开放时间和结束时间！');\n        return;\n      }\n\n      if (this.form.hasOutlet) {\n        this.has = 1;\n      } else {\n        this.has = 0;\n      }\n\n      let data = {\n        seatNum: parseInt(this.form.seatNum),\n        studyRoomId: parseInt(this.form.studyRoomId),\n        start: this.form.time[0],\n        end: this.form.time[1],\n        hasOutlet: this.has,\n        isVacant: 1\n      }; // console.log(data)\n\n      addSeat(data).then(res => {\n        this.addVisible = false;\n        this.form = {\n          seatNum: '',\n          studyRoomId: '',\n          hasOutlet: '',\n          isVacant: true,\n          time: []\n        };\n        this.$message.success('更新成功');\n        query();\n        console.log(res);\n      }).catch(err => {\n        console.log(err);\n        this.$message.success('更新失败');\n      });\n    }\n\n  },\n\n  mounted() {\n    this.query();\n  }\n\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4DA;AACA;AAEA;EACAA;IACAC;EADA,CADA;;EAIAC;IACA;MACAC,cADA;MAEAC,YAFA;MAGAC,SAHA;MAIAC,aAJA;MAKAC,iBALA;MAMAC;QACAC,WADA;QAEAC,eAFA;QAGAC,aAHA;QAIAC,cAJA;QAKAC;MALA,CANA;MAaAC,oBAbA;MAcAC;IAdA;EAgBA,CArBA;;EAsBAC;IACAC;MACA;MACA;IACA,CAJA;;IAKAC;MACA;;MACA;QACAC;UACA;YACA;cACA;YACA,CAFA,MAEA;cACA;YACA;;YACA;cACA;cACA,4DACA;cACA,8DACA;YACA;;YACA;UACA;QACA,CAhBA;MAiBA,CAlBA,MAmBA;QACAC;UACA;YACA;;YACA;cACA;gBACA;cACA,CAFA,MAGA;gBACA;cACA;;cACA,8DACA,mCARA,CASA;YACA,CAZA,CAaA;;;YACA;UACA;QACA,CAjBA;MAkBA;IAAA,CA7CA;;IA8CAC;MACA;IACA,CAhDA;;IAiDAC;MACA;QACAC,uBADA;QAEAC,sBAFA;QAGAC;MAHA,GAIAC,IAJA,CAIA;QACA;QACA;UACAC;QADA;QAGAC;UACA;YACA;YACA;UACA,CAHA,MAGA;YACA;UACA;QACA,CAPA;MAQA,CAjBA,EAiBAC,KAjBA,CAiBA;QACA;MACA,CAnBA;IAoBA,CAtEA;;IAuEAC;MACA;QACA;QACA;MACA;;MACA;QAAA;MAAA,OACA;QAAA;MAAA;;MACA;QACArB,oCADA;QAEAC,4CAFA;QAGAqB,wBAHA;QAIAC,sBAJA;QAKArB,mBALA;QAMAC;MANA,EAPA,CAeA;;MACAqB;QACA;QACA;UACAxB,WADA;UAEAC,eAFA;UAGAC,aAHA;UAIAC,cAJA;UAKAC;QALA;QAOA;QACAK;QACAgB;MACA,CAZA,EAYAL,KAZA,CAYAM;QACAD;QACA;MACA,CAfA;IAgBA;;EAvGA,CAtBA;;EAgIAE;IACA;EACA;;AAlIA","names":["components","layout","data","currentPage","pagesize","total","tableData","addVisible","form","seatNum","studyRoomId","hasOutlet","isVacant","time","labelPosition","has","methods","handleCurrentChange","query","getAllSeat","getSeat","add","delSeat","confirmButtonText","cancelButtonText","type","then","id","deleteSeat","catch","sure","start","end","addSeat","console","err","mounted"],"sourceRoot":"src/views","sources":["manager-seatmanage.vue"],"sourcesContent":["<template>\r\n    <layout>\r\n        <div>\r\n            <el-button type=\"primary\" @click=\"add\">添加</el-button>\r\n            <el-table :data=\"tableData\" border style=\"width: 100%\">\r\n                <el-table-column type=\"index\" label=\"序号\" align=\"center\" width=\"55px\" />\r\n                <el-table-column prop=\"seatNum\" label=\"座位编号\" align=\"center\" />\r\n                <el-table-column prop=\"is_Vacant\" label=\"是否空闲\" align=\"center\" />\r\n                <el-table-column prop=\"has_Outlet\" label=\"是否有插座\" align=\"center\"/>\r\n                <el-table-column\r\n                    fixed=\"right\"\r\n                    label=\"操作\"\r\n                    align=\"center\"\r\n                    width=\"100\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-button @click=\"delSeat(scope.row)\" type=\"text\" size=\"small\" >删除</el-button>\r\n                    </template>\r\n                </el-table-column>\r\n            </el-table>\r\n            <el-pagination\r\n                @current-change=\"handleCurrentChange\"\r\n                :current-page=\"currentPage\"\r\n                :page-size=\"10\"\r\n                layout=\"total, prev, pager, next, jumper\"\r\n                :total=\"total\">\r\n            </el-pagination>\r\n            <el-dialog title=\"添加座位\" :visible.sync=\"addVisible\" width=\"520px\">\r\n                <el-form :model=\"form\" :label-position=\"labelPosition\">\r\n                    <el-form-item label=\"座位编号\" >\r\n                        <el-input v-model=\"form.seatNum\" style=\"width: 450px\"/>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"自习室编号\" >\r\n                        <el-input v-model=\"form.studyRoomId\" style=\"width: 450px\"/>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"是否有插座\" >\r\n                        <el-select v-model=\"form.hasOutlet\" style=\"width: 450px\">\r\n                            <el-option label=\"是\" value=\"true\"></el-option>\r\n                            <el-option label=\"否\" value=\"false\"></el-option>\r\n                        </el-select>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"可用时间\" >\r\n                      <el-date-picker\r\n                        v-model=\"form.time\"\r\n                        type=\"datetimerange\"\r\n                        range-separator=\"至\"\r\n                        start-placeholder=\"开始时间\"\r\n                        end-placeholder=\"结束时间\"\r\n                        value-format=\"yyyy-MM-dd HH:mm:ss\">\r\n                        </el-date-picker>\r\n                    </el-form-item>\r\n                </el-form>\r\n                <span slot=\"footer\" class=\"dialog-footer\">\r\n                  <el-button type=\"primary\" @click=\"sure\">确 定</el-button>\r\n                  <el-button @click=\"addVisible = false\">取 消</el-button>\r\n                </span>\r\n            </el-dialog>\r\n        </div>\r\n    </layout>\r\n</template>\r\n<script>\r\nimport layout from '@/components/layout-page.vue'\r\nimport { getSeat,deleteSeat, addSeat, getAllSeat } from '@/api/request'\r\n\r\nexport default ({\r\n    components: {\r\n        layout,\r\n    },\r\n    data() {\r\n      return {\r\n        currentPage: 1,\r\n        pagesize: 10,\r\n        total: 10,\r\n        tableData: [],\r\n        addVisible: false,\r\n        form: {\r\n            seatNum: '',\r\n            studyRoomId: '',\r\n            hasOutlet: '',\r\n            isVacant: true,\r\n            time: [],\r\n        },\r\n        labelPosition:\"top\",\r\n        has:1\r\n      }\r\n    },\r\n    methods: {\r\n        handleCurrentChange(page) {\r\n            this.currentPage = page\r\n            this.query()\r\n        },\r\n        query() {\r\n            let roomNum = this.$route.query.roomnum\r\n            if (!roomNum){\r\n                getAllSeat().then((res) => {\r\n                    if (res){\r\n                        if(!res.length){\r\n                            this.tableData = [res]\r\n                        }else{\r\n                            this.tableData = res\r\n                        }\r\n                        for (let i in res){\r\n                            this.tableData[i] = res[i]\r\n                            if (res[i].isVacant) this.tableData[i].is_Vacant = \"是\"\r\n                            else this.tableData[i].is_Vacant = \"否\"\r\n                            if (res[i].hasOutlet) this.tableData[i].has_Outlet = \"是\"\r\n                            else this.tableData[i].has_Outlet = \"否\"\r\n                        }\r\n                        this.total = res.length\r\n                        }\r\n                })\r\n            }\r\n            else {\r\n                getSeat(roomNum).then((res) => {\r\n                if(res) {\r\n                    this.tableData = res\r\n                    for (let i in res) {\r\n                        if (res[i].isVacant) {\r\n                            this.tableData[i].is_Vacant = \"是\"\r\n                        }                            \r\n                        else {\r\n                            this.tableData[i].is_Vacant = \"否\"\r\n                        }\r\n                        if (res[i].hasOutlet) this.tableData[i].has_Outlet = \"是\"\r\n                        else this.tableData[i].has_Outlet = \"否\"\r\n                        // console.log(this.tableData[i].openStatus)\r\n                    }\r\n                    // this.is_Vacant = \r\n                    this.total = res.length\r\n                } \r\n            })\r\n        }},\r\n        add(){\r\n            this.addVisible = true\r\n        },\r\n        delSeat(val){\r\n            this.$confirm('确定要删除这个座位吗?', '提示', {\r\n                confirmButtonText: '确定',\r\n                cancelButtonText: '取消',\r\n                type: 'warning'\r\n            }).then(() => {\r\n                // console.log(typeof val.seatNum)\r\n                let data = {\r\n                    id:val.id,\r\n                }\r\n                deleteSeat(data).then((res) => {\r\n                    if(res) {\r\n                        this.query()\r\n                        this.$message.success('删除成功')\r\n                    } else {\r\n                        this.$message.success('删除失败')\r\n                    }\r\n                })\r\n            }).catch(() => {\r\n                this.$message.info('已取消')\r\n            })\r\n        },\r\n        sure(){\r\n            if( !this.form.seatNum || !this.form.time) {\r\n                this.$message.info('请填写座位编号、开放时间和结束时间！')\r\n                return\r\n            }\r\n            if (this.form.hasOutlet) {this.has = 1}\r\n            else {this.has = 0}\r\n            let data={\r\n                seatNum: parseInt(this.form.seatNum),\r\n                studyRoomId:parseInt(this.form.studyRoomId),\r\n                start:this.form.time[0],\r\n                end:this.form.time[1],\r\n                hasOutlet: this.has,\r\n                isVacant:1,\r\n            }\r\n            // console.log(data)\r\n            addSeat(data).then((res) => {\r\n                    this.addVisible = false\r\n                    this.form= {\r\n                        seatNum: '',\r\n                        studyRoomId: '',\r\n                        hasOutlet: '',\r\n                        isVacant: true,\r\n                        time: [],\r\n                    }\r\n                    this.$message.success('更新成功')\r\n                    query()\r\n                console.log(res)\r\n            }).catch(err=>{\r\n                console.log(err)\r\n                this.$message.success('更新失败')\r\n            })\r\n        },\r\n\r\n    },\r\n    mounted() {\r\n        this.query()\r\n    },\r\n})\r\n</script>\r\n<style scoped>\r\n.el-table {\r\n    margin-top: 15px;\r\n}\r\n.el-pagination {\r\n    margin-top: 15px;\r\n    float: right;\r\n}\r\n.item {\r\n  width: 32px;\r\n  height: 32px;\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}