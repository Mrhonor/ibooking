{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport layout from '@/components/layout-page.vue';\nimport { getStudyRoom, renewStudyRoom, bookingCheck } from '@/api/request';\nexport default {\n  components: {\n    layout\n  },\n\n  data() {\n    return {\n      currentPage: 1,\n      pagesize: 10,\n      total: 10,\n      tableData: [],\n      Visible: false,\n      bookingVal: '',\n      bookingInfo: [],\n      form: {\n        index: '',\n        stuRoomNumber: '',\n        buildingNumber: '',\n        classRoomNumber: '',\n        openStatus: '',\n        time: '',\n        returnTime: []\n      },\n      open: true,\n      status: ''\n    };\n  },\n\n  methods: {\n    handleCurrentChange(page) {\n      this.currentPage = page;\n      this.query();\n    },\n\n    query() {\n      getStudyRoom().then(res => {\n        if (res) {\n          this.tableData = res;\n\n          for (let i in res) {\n            if (res[i].openStatus) this.tableData[i].openStatus = \"是\";else this.tableData[i].openStatus = \"否\"; // console.log(this.tableData[i].openStatus)\n          }\n\n          this.total = res.length;\n        }\n      });\n    },\n\n    done(val) {\n      const params = val.stuNum;\n      bookingCheck(params).then(res => {\n        if (res) {\n          this.$message.success('签到成功');\n          this.bookingInfo = res['预约信息'];\n          localStorage.setItem('bookingInfo', JSON.stringify(this.bookingInfo));\n        } else {\n          this.$message.success('签到失败');\n        }\n      });\n    },\n\n    renewRoom(val) {\n      // this.form.id = val.index\n      this.form.stuRoomNumber = val.stuRoomNumber;\n      this.form.buildingNumber = val.buildingNumber;\n      this.form.classRoomNumber = val.classRoomNumber; // console.log(val.openStatus)\n      // if (val.openStatus==\"是\") this.status = \"true\"\n      // else this.status = \"false\"\n      // console.log(this.status)\n\n      this.form.openStatus = val.openStatus;\n      console.log('更新', this.form.openStatus);\n      this.form.returnTime.push(val.startTime, val.endTime);\n      this.Visible = true;\n    },\n\n    check() {\n      if (this.bookingInfo.length === 0) {\n        this.$message.info('请先进行签到或者预约,才能查看预约信息');\n        return;\n      }\n\n      this.$router.push({\n        name: 'account',\n        params: {\n          bookingInfo: this.bookingInfo\n        }\n      });\n    },\n\n    sure() {\n      // console.log(this.form.openStatus)\n      if (this.form.openStatus == \"是\" && !this.form.time) {\n        // console.log(this.form.openStatus, !this.form.time)\n        this.$message.info('请选择自习室开放时间和结束时间！');\n        return;\n      }\n\n      if (!this.form.time) {\n        this.form.time = [null, null]; //灰色\n        // console.log(this.form.time)\n      }\n\n      console.log(this.form.openStatus);\n      if (this.form.openStatus == \"是\" || this.form.openStatus == \"true\") this.open = true;else this.open = false;\n      let data = {\n        // id: this.form.index,\n        stuRoomNumber: this.form.stuRoomNumber,\n        buildingNumber: this.form.buildingNumber,\n        classRoomNumber: this.form.classRoomNumber,\n        openStatus: this.open,\n        startTime: this.form.time[0],\n        endTime: this.form.time[1]\n      }; // console.log(data)\n\n      renewStudyRoom(data).then(res => {\n        console.log(data, res);\n        this.Visible = false;\n        this.form = {\n          index: '',\n          stuRoomNumber: '',\n          buildingNumber: '',\n          classRoomNumber: '',\n          openStatus: '',\n          time: '',\n          returnTime: []\n        }; // console.log(this.form)\n        // this.renewInfo = res['预约信息']\n        // localStorage.setItem('bookingInfo', JSON.stringify(this.bookingInfo))\n\n        this.$message.success('更新成功');\n        getStudyRoom().then(res => {\n          if (res) {\n            this.tableData = res;\n\n            for (let i in res) {\n              if (res[i].openStatus) this.tableData[i].openStatus = \"是\";else this.tableData[i].openStatus = \"否\"; // console.log(this.tableData[i].openStatus)\n            }\n\n            this.total = res.length;\n          }\n        });\n      }).catch(err => {\n        console.log(err);\n        this.$message.success('更新失败');\n      });\n    }\n\n  },\n\n  mounted() {\n    this.query();\n  }\n\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoFA;AACA;AAEA;EACAA;IACAC;EADA,CADA;;EAIAC;IACA;MACAC,cADA;MAEAC,YAFA;MAGAC,SAHA;MAIAC,aAJA;MAKAC,cALA;MAMAC,cANA;MAOAC,eAPA;MAQAC;QACAC,SADA;QAEAC,iBAFA;QAGAC,kBAHA;QAIAC,mBAJA;QAKAC,cALA;QAMAC,QANA;QAOAC;MAPA,CARA;MAiBAC,UAjBA;MAkBAC;IAlBA;EAoBA,CAzBA;;EA0BAC;IACAC;MACA;MACA;IACA,CAJA;;IAKAC;MACAC;QACA;UACA;;UACA;YACA,+DACA,mCAFA,CAGA;UACA;;UACA;QACA;MACA,CAVA;IAWA,CAjBA;;IAkBAC;MACA;MACAC;QACA;UACA;UACA;UACAC;QAEA,CALA,MAKA;UACA;QACA;MACA,CATA;IAUA,CA9BA;;IA+BAC;MACA;MACA;MACA;MACA,gDAJA,CAKA;MACA;MACA;MACA;;MACA;MACAC;MACA;MACA;IACA,CA5CA;;IA6CAC;MACA;QACA;QACA;MACA;;MACA;QAAAC;QAAAC;UAAAtB;QAAA;MAAA;IACA,CAnDA;;IAoDAuB;MACA;MACA;QACA;QACA;QACA;MACA;;MACA;QACA,8BADA,CACA;QACA;MACA;;MACAJ;MACA,yFACA;MACA;QACA;QACAhB,sCAFA;QAGAC,wCAHA;QAIAC,0CAJA;QAKAC,qBALA;QAMAkB,4BANA;QAOAC;MAPA,EAdA,CAuBA;;MACAC;QACAP;QACA;QACA;UACAjB,SADA;UAEAC,iBAFA;UAGAC,kBAHA;UAIAC,mBAJA;UAKAC,cALA;UAMAC,QANA;UAOAC;QAPA,EAHA,CAYA;QACA;QACA;;QACA;QACAM;UACA;YACA;;YACA;cACA,+DACA,mCAFA,CAGA;YACA;;YACA;UACA;QACA,CAVA;MAWA,CA3BA,EA2BAa,KA3BA,CA2BAC;QACAT;QACA;MACA,CA9BA;IA+BA;;EA3GA,CA1BA;;EAuIAU;IACA;EACA;;AAzIA","names":["components","layout","data","currentPage","pagesize","total","tableData","Visible","bookingVal","bookingInfo","form","index","stuRoomNumber","buildingNumber","classRoomNumber","openStatus","time","returnTime","open","status","methods","handleCurrentChange","query","getStudyRoom","done","bookingCheck","localStorage","renewRoom","console","check","name","params","sure","startTime","endTime","renewStudyRoom","catch","err","mounted"],"sourceRoot":"src/views","sources":["manager-roommanage.vue"],"sourcesContent":["<template>\r\n    <layout>\r\n        <div>\r\n            <el-button type=\"primary\" @click=\"query\">查询</el-button>\r\n            <el-table :data=\"tableData\" border style=\"width: 100%\">\r\n                <el-table-column type=\"index\" label=\"序号\" align=\"center\" width=\"55px\" />\r\n                <el-table-column prop=\"stuRoomNumber\" label=\"编号\" align=\"center\" />\r\n                <el-table-column prop=\"buildingNumber\" label=\"所处楼栋\" align=\"center\" />\r\n                <el-table-column prop=\"classRoomNumber\" label=\"所处教室\" align=\"center\"/>\r\n                <el-table-column prop=\"openStatus\" label=\"是否开放\" align=\"center\">\r\n                    <!-- <template slot-scope=\"scope\">\r\n                        <el-checkbox :true-label=\"1\" :false-label=\"0\" v-model=\"scope.row.displayStatus\" @change=\"changeStatus\"></el-checkbox>\r\n                    </template> -->\r\n                </el-table-column>\r\n                <el-table-column prop=\"startTime\" type=\"datatime\" label=\"开放时间\" align=\"center\"/>\r\n                <el-table-column prop=\"endTime\" type=\"datatime\" label=\"关闭时间\" align=\"center\"/>\r\n                <el-table-column\r\n                    fixed=\"right\"\r\n                    label=\"操作\"\r\n                    align=\"center\"\r\n                    width=\"100\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-button @click=\"renewRoom(scope.row)\" type=\"text\" size=\"small\">更新</el-button>\r\n                        <el-button @click=\"deleteRoom(scope.row)\" type=\"text\" size=\"small\">删除</el-button>\r\n                        <el-button @click=\"check(scope.row)\" type=\"text\" size=\"small\">查看</el-button>\r\n                    </template>\r\n                </el-table-column>\r\n            </el-table>\r\n            <el-pagination\r\n                @current-change=\"handleCurrentChange\"\r\n                :current-page=\"currentPage\"\r\n                :page-size=\"10\"\r\n                layout=\"total, prev, pager, next, jumper\"\r\n                :total=\"total\">\r\n            </el-pagination>\r\n            <el-dialog title=\"更新自习室信息\" :visible.sync=\"Visible\" width=\"520px\">\r\n                <el-form :model=\"form\">\r\n                    <el-form-item label=\"自习室编号\" >\r\n                        <el-input v-model=\"form.stuRoomNumber\" style=\"width: 385px\"/>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"所处楼栋\" >\r\n                        <el-input v-model=\"form.buildingNumber\" style=\"width: 400px\"/>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"所处教室\" >\r\n                        <el-input v-model=\"form.classRoomNumber\" style=\"width: 400px\"/>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"是否开放\" >\r\n                        <el-select v-model=\"form.openStatus\" style=\"width: 400px\">\r\n                            <el-option label=\"是\" value=\"true\"></el-option>\r\n                            <el-option label=\"否\" value=\"false\"></el-option>\r\n                        </el-select>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"开放时间\" >\r\n                      <!-- <el-date-picker\r\n                        v-model=\"form.time\"\r\n                        type=\"datetimerange\"\r\n                        range-separator=\"至\"\r\n                        start-placeholder=\"开始日期\"\r\n                        end-placeholder=\"结束日期\"\r\n                        value-format=\"yyyy-MM-dd HH:mm:ss\">\r\n                        :default-value=\"form.returnTime\"\r\n                        </el-date-picker> -->\r\n                        <el-time-picker\r\n                            v-model=\"form.time\"\r\n                            format=\"HH:mm:ss\"\r\n                            value-format=\"HH:mm:ss\"\r\n                            style=\"width: 380px\"\r\n                            is-range\r\n                            range-separator=\"至\"\r\n                            start-placeholder=\"开始时间\"\r\n                            end-placeholder=\"结束时间\"\r\n                            placeholder=\"选择时间范围\"\r\n                        />\r\n                    </el-form-item>\r\n                </el-form>\r\n                <span slot=\"footer\" class=\"dialog-footer\">\r\n                  <el-button type=\"primary\" @click=\"sure\">确 定</el-button>\r\n                  <el-button @click=\"Visible = false\">取 消</el-button>\r\n                </span>\r\n            </el-dialog>\r\n        </div>\r\n    </layout>\r\n</template>\r\n<script>\r\nimport layout from '@/components/layout-page.vue'\r\nimport { getStudyRoom, renewStudyRoom, bookingCheck} from '@/api/request'\r\n\r\nexport default ({\r\n    components: {\r\n        layout,\r\n    },\r\n    data() {\r\n      return {\r\n        currentPage: 1,\r\n        pagesize: 10,\r\n        total: 10,\r\n        tableData: [],\r\n        Visible: false,\r\n        bookingVal: '',\r\n        bookingInfo: [],\r\n        form: {\r\n            index: '',\r\n            stuRoomNumber: '',\r\n            buildingNumber: '',\r\n            classRoomNumber: '',\r\n            openStatus: '',\r\n            time: '',\r\n            returnTime:[],\r\n        },\r\n        open: true,\r\n        status: '',\r\n      }\r\n    },\r\n    methods: {\r\n        handleCurrentChange(page) {\r\n            this.currentPage = page\r\n            this.query()\r\n        },\r\n        query() {\r\n            getStudyRoom().then((res) => {\r\n                if(res) {\r\n                    this.tableData = res\r\n                    for (let i in res) {\r\n                        if (res[i].openStatus) this.tableData[i].openStatus = \"是\"\r\n                        else this.tableData[i].openStatus = \"否\"\r\n                        // console.log(this.tableData[i].openStatus)\r\n                    }\r\n                    this.total = res.length\r\n                } \r\n            })\r\n        },\r\n        done(val) {\r\n            const params = val.stuNum\r\n            bookingCheck(params).then((res) => {\r\n                if(res) {\r\n                    this.$message.success('签到成功')\r\n                    this.bookingInfo = res['预约信息']\r\n                    localStorage.setItem('bookingInfo', JSON.stringify(this.bookingInfo) )\r\n\r\n                } else {\r\n                    this.$message.success('签到失败')\r\n                }\r\n            })\r\n        },\r\n        renewRoom(val) {\r\n            // this.form.id = val.index\r\n            this.form.stuRoomNumber = val.stuRoomNumber\r\n            this.form.buildingNumber = val.buildingNumber\r\n            this.form.classRoomNumber = val.classRoomNumber\r\n            // console.log(val.openStatus)\r\n            // if (val.openStatus==\"是\") this.status = \"true\"\r\n            // else this.status = \"false\"\r\n            // console.log(this.status)\r\n            this.form.openStatus = val.openStatus\r\n            console.log('更新', this.form.openStatus)\r\n            this.form.returnTime.push(val.startTime, val.endTime)\r\n            this.Visible = true\r\n        },\r\n        check() {\r\n            if(this.bookingInfo.length === 0) {\r\n                this.$message.info('请先进行签到或者预约,才能查看预约信息')\r\n                return\r\n            }\r\n            this.$router.push({ name: 'account', params: {bookingInfo: this.bookingInfo} })\r\n        },\r\n        sure() {\r\n            // console.log(this.form.openStatus)\r\n            if( this.form.openStatus==\"是\" && !this.form.time) {\r\n                // console.log(this.form.openStatus, !this.form.time)\r\n                this.$message.info('请选择自习室开放时间和结束时间！')\r\n                return\r\n            }\r\n            if(!this.form.time){\r\n                this.form.time = [null, null]//灰色\r\n                // console.log(this.form.time)\r\n            }\r\n            console.log(this.form.openStatus)\r\n            if (this.form.openStatus == \"是\"||this.form.openStatus==\"true\") this.open = true\r\n            else this.open=false\r\n            let data = {\r\n                // id: this.form.index,\r\n                stuRoomNumber: this.form.stuRoomNumber,\r\n                buildingNumber: this.form.buildingNumber,\r\n                classRoomNumber: this.form.classRoomNumber,\r\n                openStatus: this.open,\r\n                startTime: this.form.time[0],\r\n                endTime: this.form.time[1],\r\n            }\r\n            // console.log(data)\r\n            renewStudyRoom(data).then((res) => {\r\n                console.log(data, res)\r\n                this.Visible = false\r\n                this.form = {\r\n                        index: '',\r\n                        stuRoomNumber: '',\r\n                        buildingNumber: '',\r\n                        classRoomNumber: '',\r\n                        openStatus: '',\r\n                        time: '',\r\n                        returnTime:[],\r\n                }\r\n                // console.log(this.form)\r\n                    // this.renewInfo = res['预约信息']\r\n                    // localStorage.setItem('bookingInfo', JSON.stringify(this.bookingInfo))\r\n                this.$message.success('更新成功')\r\n                getStudyRoom().then((res) => {\r\n                if(res) {\r\n                    this.tableData = res\r\n                    for (let i in res) {\r\n                        if (res[i].openStatus) this.tableData[i].openStatus = \"是\"\r\n                        else this.tableData[i].openStatus = \"否\"\r\n                        // console.log(this.tableData[i].openStatus)\r\n                    }\r\n                    this.total = res.length\r\n                } \r\n            })\r\n            }).catch(err=>{\r\n                console.log(err)\r\n                this.$message.success('更新失败')\r\n            })\r\n        },\r\n    },\r\n    mounted() {\r\n        this.query()\r\n    },\r\n})\r\n</script>\r\n<style scoped>\r\n.el-table {\r\n    margin-top: 15px;\r\n}\r\n.el-pagination {\r\n    margin-top: 15px;\r\n    float: right;\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}